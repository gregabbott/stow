<!-- Merged 2025_04_27 -->
<html lang="en"><head><meta charset="UTF-8"><meta name="color-scheme" content="light dark"><link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiICB4PSIwIiB5PSIwIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj4KICA8c3R5bGU+LmF7CmZpbGw6IzI1MjUyNTsKZm9udC1mYW1pbHk6VmVyZGFuYTsKdGV4dC1hbmNob3I6bWlkZGxlOwp9PC9zdHlsZT4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI0ZGRiIvPjx0ZXh0IGNsYXNzPSJhIiBmb250LXNpemU9IjY4cHgiIHg9IjEwMCIgeT0iMTE2Ljg3NSI+U3RvdzwvdGV4dD48L3N2Zz4="><style>/* frame.css */
:root {color-scheme: light dark;--light: hsl(0, 0%, 100%);--dark: hsl(0, 0%, 0%);--bg: light-dark(var(--light), var(--dark));--fg: light-dark(var(--dark), var(--light));}.full_viewport_notice {position: fixed;background-color: var(--bg);color: var(--fg);padding: 2ch;top: 0;left: 0;height: 100dvh;width: 100dvw;z-index: 999;display: flex;flex-direction: column;align-items: center;justify-content: center;text-align: center;}[popover]{z-index: 9999;margin: 2lh auto;width: 64ch;max-width: calc(100dvh - 2ch);}* {box-sizing: border-box;font-size:1em;user-select: none;}.disabled {pointer-events: none;opacity: .5;}html,body {height:100dvh;max-height:100dvh;margin: 0 auto;}body{color: var(--fg);background-color: var(--bg);display: flex;flex-direction: column;}main {display: flex;flex-grow: 1;overflow: hidden;}g-search {display: flex;align-items: center;input {flex: 1 0 auto;}}#menu_items {display: flex;flex-direction: column;}table{width: 100%;border-collapse: collapse;}g-db{height: 100%;display:flex;flex-direction: column;#table_holder{height: 0;display: flex;flex-direction: column;flex: 1 1 auto;overflow: hidden;table {display: flex;flex-direction: column;overflow: hidden;position: relative;tbody {flex-grow: 1;overflow-y: scroll;scrollbar-gutter: stable;}tr {display: table;table-layout: fixed;width: 100%;}td:first-of-type{width: 6ch;padding: 0 1ch 0 0;}}}}aside{min-width: 24ch;display: flex;flex-direction: column;}.aside_main{overflow-y: auto;flex-grow: 1;ul {padding-left: 2ch;}div > ul {padding: 0;}li {list-style-type: none;& > label {padding-left: 4ch;span:nth-child(3){float: right;}}}details {position: relative;}summary {display: flex;position: sticky;align-items: center;top: 0;z-index:1;background-color: var(--bg);width: 100%;label {flex-grow: 1;span:nth-child(3) {float: right;}}&::before {content: ' [+]';}}details[open] > summary::before{content: ' [-]';}> details > summary {z-index:2;height: 3ch;}details details summary {z-index:1;top:3ch;}}body:has(:popover-open){#hide_popover{display: block;}}::backdrop {opacity: 0;}#hide_popover{display: none;z-index: 99;background: var(--dark);opacity: 0;width: 100dvw;height: 100dvh;position: fixed;top: 0;left: 0;}.hide {display: none !important;}#editor_po{input {width: 100%;}}</style><!-- STOW. By + copyright 2025 Greg Abbott--><style>/* look.css */
:root{--light: hsl(0, 0%, 100%);--dark: hsl(0, 0%, 0%);--accent: #8e70f7;--brd: 1px solid var(--fg);}* {font-family: "CommitMono", monospace;gap:1ch;outline: none;background-color: transparent;color: var(--fg);}[popover],[dialog] {border-radius: 5px;padding: 1ch;background: var(--bg);}body {font-size: 14px;padding: 1ch;}::-webkit-scrollbar{width: 1ch;height: 1ch;cursor: pointer;}::-webkit-scrollbar-thumb {background: var(--bg);border: var(--brd);border-radius: 100px;}::-webkit-scrollbar-track,::-webkit-scrollbar-corner {background: transparent;}button{cursor: pointer;}input[type='text']:focus{box-shadow: inset 0 0 0 1px var(--fg);}input {border: var(--brd);}g-db {tr {border: 1px solid transparent;}tr, td {padding: 0;margin: 0;line-height: 100%;}td input[type="checkbox"]{padding: 0;margin: 0;height: 10px;vertical-align: middle;}}hr {height: 1px;background-color: var(--fg);border: none;}g-search {position: relative;input{width: 100%;height: 4ch;padding: 1ch;}button {position: absolute;right: 1ch;height: 1.5lh;background-color: var(--bg);display: none;}&:focus-within > button,input:not(:placeholder-shown) + button {display: block;}}#main_menu_po{padding: 0;footer{border-top: var(--brd);padding: 1ch;}g-search {margin: 1ch;}#menu_items {margin: 1ch 0ch 1ch 0;padding: 0ch 1ch 0ch 1ch;max-height: 50dvh;overflow-y: auto;&::-webkit-scrollbar{width: 2ch;height: 1ch;cursor: pointer;}&::-webkit-scrollbar-thumb {background: var(--bg);border-radius: 0;box-shadow: inset 0 0 0 1px var(--fg);border: none;border-right: 1ch solid var(--bg);}gap: 0;div {display: flex;align-items: center;padding: 5px;border:1px solid transparent;&:hover {border: 1px dashed var(--fg);}input {display: none;padding: 0;margin: 0;}&:has(input:checked){border: var(--brd);}button {cursor: default;padding: 0;height: auto;border: none;&:hover,&:focus {box-shadow:none;outline-color: transparent;}&:active{background-color: var(--bg);color: var(--fg);}}}}}g-db tr:has(td input:checked){border-color: var(--fg);}button {background-color: transparent;border: var(--brd);height:3ch;border-radius: 100px;padding: 0 1ch;line-height: 100%;&:active {background-color: var(--fg);color: var(--bg);}&:focus,&:hover {box-shadow: inset 0 0 0 1px var(--fg);}}:disabled,:hover:disabled,:active:disabled {background-color: transparent;box-shadow: none;cursor: not-allowed;color: var(--fg);border-style: dashed;}#file_load_stored{background-color: var(--fg);color: var(--bg);}#a_few_buttons button{width: 100%;border: none;}aside footer {display: flex;align-items: end;position: relative;opacity: 10%;}aside footer{&:hover,&:focus,&:focus-within,&:active{opacity: 100%;}}.credit, .credit *{font-size: 9px;}.credit {text-align: center;width: 100%;button{all:unset;padding: 1px 1ch;border-radius: 3px;}}.aside_main, g-db tbody {padding-right: 1ch;}#editor_po{input {margin-bottom: 1ch;}}</style><title>Stow</title></head><body><div popover="" id="po_license"><p>Name: <span title="STOW Means:
To pack or store (an object) carefully and neatly
To place or arrange in a compact mass
To put an object in its proper place, or in a suitable place">Stow</span><br>
Version: 2025_0427 <i>(Pre-alpha)</i><br>
View: <a href="log.html">Change Log</a><br>
By: <a href="https://gregabbott.pages.dev/">Greg Abbott</a></p><hr><p>LICENSE<br>
Â© 2025 Greg Abbott. All rights reserved.</p><p>NO WARRANTY<br>
THE SOFTWARE IS PROVIDED "AS IS",
WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE
AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</p></div><noscript><div class="full_viewport_notice"><p>This tool requires JavaScript<br><a href="https://gregabbott.pages.dev/">View other tools</a></p></div></noscript><div id="unsupported_browser" class="full_viewport_notice hide"><div><p>Your browser doesn't support the File Access API.<br>
This tool uses it to edit local files.</p><p><a href="https://gregabbott.pages.dev/">View other tools</a></p></div></div><div id="main_menu_po" popover=""><g-search><input type="text" id="menu_items_searcher"><button id="clear_menu_items_searcher">x</button></g-search><div id="menu_items"><div id="file_select"><input type="radio" name="mi"><button>Open File</button></div><div id="file_close"><input type="radio" name="mi"><button>Close File</button></div><div id="file_forget"><input type="radio" name="mi"><button>Forget File</button></div><div id="file_save"><input type="radio" name="mi"><button>Save</button></div><div id="file_save_as"><input type="radio" name="mi"><button>Save As</button></div><div id="add_new_record"><input type="radio" name="mi"><button>Add Record</button></div><div id="show_delete_dialog"><input type="radio" name="mi"><button>Bin Record</button></div><div id="clone_record"><input type="radio" name="mi"><button>Clone Record</button></div><div id="edit_record"><input type="radio" name="mi"><button>Change Record</button></div><div id="mark_done"><input type="radio" name="mi"><button>Tick Record</button></div><div id="mark_undone"><input type="radio" name="mi"><button>Untick Record</button></div><div id="show_po_license"><input type="radio" name="mi"><button>About and License</button></div></div><footer><div id="file_status"></div></footer></div><dialog id="file_dialog"><p id="file_dialog_message"></p><menu><button id="file_dialog_done_button">done</button></menu></dialog><nav><g-notice></g-notice></nav><main><g-db><div id="table_holder"><table><thead><tr><td></td><td>Showing <span id="visible_records"></span></td></tr><tr><td><button id="deselect_all" title="Deselect All Records">x</button></td><td><g-search><input title="Search Records" placeholder="" type="text" id="records_search_query" size="64"><button id="clear_records_search_query" title="Clear record search">x</button></g-search></td></tr></thead><tbody id="records_list"></tbody></table></div><div id="editor_po" popover=""><input type="text" id="editor" size="48"><button id="apply_edit">Keep</button><button id="cancel_edit" title="Cancel">Close</button></div></g-db><aside><div id="a_few_buttons"><button id="show_main_menu_po">Menu</button><button id="file_load_stored">Reopen</button></div><div class="aside_main"><details open=""><summary> State</summary><table><tbody id="statesList"><tr><td><input name="state_rad" type="radio" checked="" id="show_state_any"><label for="show_state_any">Any</label></td><td id="show_state_count_all"></td></tr><tr><td><input name="state_rad" type="radio" id="show_state_todo"><label for="show_state_todo">Do</label></td><td id="show_state_count_todo"></td></tr><tr><td><input name="state_rad" type="radio" id="show_state_done"><label for="show_state_done">Done</label></td><td id="show_state_count_done"></td></tr></tbody></table></details><details open=""><summary><button id="strip_from_search_value_any_groups" title="Clear any '+group' filters from the search field">x</button> Group </summary><div id="groups_list"></div></details><details open=""><summary><button id="strip_from_search_value_any_tags" title="Clear any '@tag' filters from the search field">x</button> Tag </summary><div id="tags_list"></div></details></div><footer class="hide"><div><button popovertarget="po_license">Â© 2025</button><a href="https://gregabbott.pages.dev/">Greg Abbott</a></div></footer></aside></main><dialog id="delete_dialog"><p>Per record selected:</p><button id="delete_confirm" autofocus="">Bin</button><button id="delete_cancel">Keep</button></dialog><div id="hide_popover"></div><script>/* 
j.js
 */
const el=[...document.querySelectorAll('[id]:not([id=""])')].reduce(((e,t)=>(e[t.id.trim()]=t,e)),{});["g-search","g-notice"].forEach((e=>{el[e.replace("g-","")]=document.querySelector("g-notice")}));let g0={};function reset_db(){g0.db={},g0.db.groups={},g0.db.tags={},g0.db.records=new Set,g0.record_els=[],g0.record_els_matching_search_filter=[],g0.menu_items_matching_search=[],g0.selected_menu_item=null,g0.prop_els=new Map,g0.selected_records=new Set,g0.input_blur_timeout=null,g0.file_is_loaded=!1,g0.has_unsaved_changes=!1,g0.last_saved_content=""}reset_db();const tag_prefixes=new Set(["+","@"]),mark_need_to_save=()=>{g0.has_unsaved_changes=!0},for_loop=e=>t=>{for(let r=0;r<t.length;r++)e(t[r])};function new_el(e,t){let r=document.createElement(e);return t?t.appendChild(r):r}function on(e,t,r){return r?(r.addEventListener(e,t),r):r=>on(e,t,r)}function get_date_parts(e=new Date){const t=["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],r=["Y","M","d","h","m","s","u"].reduce(((r,_,o)=>{return r[_]=(e[s="get"+t[o]]()+("getMonth"===s)+"").padStart("getMilliseconds"===s?3:2,"0"),r;var s}),{});return r.c=r.Y.substring(0,2),r.y=r.Y.substring(2),r}function get_stamp(e=new Date){let t=get_date_parts(e);return"Y_Md_hm".split("").map((e=>t[e]||e)).join("")}function reset_app(){reset_db(),load_db_to_frontend()}function load_example_db(){let e=get_stamp();string_db_to_live_db(`x (A) ${e+"Z"} ${e+"A"} Show an example record @today +app/demo`),load_db_to_frontend()}function restore(e){if(!e)return console.log("No data stored to restore");string_db_to_live_db(e),load_db_to_frontend()}function setup_auto_save(){function e(){g0.file_is_loaded&&g0.page_loaded&&g0.has_unsaved_changes&&f_action.file_save()}on("blur",e,window),on("beforeunload",e,window),on("pagehide",e,window),on("visibilitychange",e,document),g0.page_loaded=!0}function task_line_to_db_object(e){let t=e.trim()+(e.endsWith(" ")?" ":""),r=t.toLowerCase(),_=t.startsWith("x "),o=r.split(" "),s=r.split(/ |\/|\+|@/),n="",l="",d=0;_?(n=o[1],l=o[2],d=3):/^\d{4}-\d{2}-\d{2}$/.test(o[0])&&(l=o[0],d=1);let i=o.slice(d).join(" "),a={groups:new Set([]),tags:new Set([])};return i.split(" ").forEach((e=>{if(e.length<2)return;if("+"!==e[0]&&"@"!==e[0])return;let t={"+":"groups","@":"tags"}[e[0]],r=e.slice(1).toLowerCase().split("/"),_="";r.forEach((e=>{_=_?_+"/"+e:e,a[t].add(_)}))})),{raw:t,lowTrimmed:r,words:s,done:_,done_date:n,made:l,groups:[...a.groups],tags:[...a.tags]}}function remove_record_data_to_db_collections(e){["groups","tags"].forEach((t=>{e[t].forEach((e=>{g0.db[t][e]&&(g0.db[t][e]=g0.db[t][e]-1,0==g0.db[t][e]&&(delete g0.db[t][e],g0.prop_els.delete(e)))}))}))}function add_record_data_to_db_collections(e){e.groups.forEach((e=>{g0.db.groups[e]=g0.db.groups[e]+1||1})),e.tags.forEach((e=>{g0.db.tags[e]=g0.db.tags[e]+1||1}))}function by_key_sorter(e){return(t,r)=>t[e]<r[e]?-1:t[e]>r[e]?1:0}function string_db_to_live_db(e){let t=new Set;g0.db.records.forEach((e=>{t.add(e.lowTrimmed)})),e.trim().split("\n").filter((e=>e.trim())).reduce(((e,r)=>{if(t.has(r.toLowerCase().trim()))return e;let _=task_line_to_db_object(r);return e.add(_),add_record_data_to_db_collections(_),e}),g0.db.records)}function update_sidebars(){fill_sidebar_list__groups(),fill_sidebar_list__tags()}function get_first_set_item(e){if(!e||0===e.size)return null;for(const t of e)return t}function get_only_selected_record_else_false(){return 1===g0.selected_records.size&&get_first_set_item(g0.selected_records)}function start_edit_mode_if_one_record_selected(){let e=get_only_selected_record_else_false();e&&e.dom.row.click()}function select_record_or_not_based_on_checked_state(e){e.is_selected?(select_record_if_not_hidden(e),e.dom.selector.checked=!0):deselect_record(e)}function strip_date(e,t="g"){let r=String.raw`(?:^|\s)([\d\-:_\./]{10,}[AZ])(?=\s|$)`,_=RegExp(r,t);return e.replace(_,"").replace(/\s{2,}/g," ").trim()}function strip_first_date(e){return strip_date(e,"")}function strip_all_dates(e){return strip_date(e,"g")}function make_record_preview_string(e){let t=strip_all_dates(e.raw);return 0===t.length?"[Record lacks data]":t}function record_row_click_fn(e){const t=e.target.closest("tr");if(!t)return;let r=t.record;e.target==r.dom.selector?select_record_or_not_based_on_checked_state(r):g0.selected_records.has(r)&&1===g0.selected_records.size?start_edit_mode(r):(deselect_all_records(),select_record_if_not_hidden(r))}function make_record_el__does_not_add_to_dom(e){let t=new_el("tr");t.className="record";let r=new_el("td",t),_=new_el("input",r);_.type="checkbox",_.name="selected_records";let o=new_el("td",t),s=new_el("span",o);return s.textContent=make_record_preview_string(e),t.record={data:e,get is_selected(){return!0===_.checked},dom:{row:t,selector:_,preview:s}},g0.record_els.push(t),t.record}function sort_records_on_dom__adds_any_not_added(){const e=document.createDocumentFragment();g0.record_els.sort(((e,t)=>e.record.data.lowTrimmed.localeCompare(t.record.data.lowTrimmed))).forEach((t=>{e.appendChild(t)})),el.records_list.innerHTML="",el.records_list.appendChild(e)}function load_db_to_frontend(){el.records_list.innerHTML="",[...g0.db.records].sort(by_key_sorter("raw")).forEach(make_record_el__does_not_add_to_dom),sort_records_on_dom__adds_any_not_added(),update_sidebars(),select_record_below(),filter_records();g0.db.records.size;update_visible_records_count_frontend()}function is_array(e){return Array.isArray(e)}function supports_disabled(e){return["INPUT","BUTTON","SELECT","TEXTAREA"].includes(e.tagName)}function disable_one(e){supports_disabled(e)?e.disabled=!0:e.classList.add("disabled")}function enable_one(e){supports_disabled(e)?e.disabled=!1:e.classList.remove("disabled")}function disable(e){is_array(e)?e.forEach(disable_one):disable_one(e)}function enable(e){is_array(e)?e.forEach(enable_one):enable_one(e)}on("click",record_row_click_fn,el.records_list);let edit_mode_active=!1;function leave_edit_mode(){edit_mode_active=!1,el.editor.value="",disable([el.apply_edit,el.editor,el.cancel_edit]),el.editor_po.matches(":popover-open")&&el.editor_po.hidePopover(),g0.selected_records.size>0&&enable(record_related_buttons),enable(el.search)}function clear_menu_items_searcher(){0==el.menu_items_searcher.value.trim().length?(el.menu_items_searcher.blur(),el.main_menu_po.hidePopover()):(el.menu_items_searcher.value="",el.menu_items_searcher.focus(),search_menu_items())}function show_license_popover(){el.po_license.showPopover()}function show_main_menu_popover(){el.main_menu_po.showPopover(),el.menu_items_searcher.focus()}on("toggle",(()=>{!el.editor_po.matches(":popover-open")&&edit_mode_active&&leave_edit_mode()}),el.editor_po),on("click",leave_edit_mode,el.cancel_edit),on("click",clear_menu_items_searcher,el.clear_menu_items_searcher),on("input",search_menu_items,el.menu_items_searcher),on("click",(e=>{el.main_menu_po.hidePopover()}),el.menu_items),on("click",show_license_popover,el.show_po_license),on("click",show_main_menu_popover,el.show_main_menu_po),on("focus",(()=>{search_menu_items()}),el.menu_items_searcher);let menu_items=[...el.menu_items.getElementsByTagName("div")].map((e=>{let t={dom:e,dom_text:e.textContent.toLowerCase().trim()};return t.words=t.dom_text.split(/\s+/),t}));function search_menu_items(){let e=el.menu_items_searcher.value.toLowerCase().trim();function t(e){g0.menu_items_matching_search.push(e),show(e.dom)}if(g0.menu_items_matching_search.length=0,g0.selected_menu_item=null,0==e.length)menu_items.forEach((e=>{!e.dom.classList.contains("disabled")?t(e):hide(e.dom)}));else{let r=e.split(/\s+/),_=1===r.length;menu_items.forEach((e=>{let o,s=!e.dom.classList.contains("disabled");var n;_?o=e.dom_text.includes(r[0]):(n=e.words,o=r.every((e=>n.some((t=>t.startsWith(e)))))),s&&o?t(e):hide(e.dom)}))}select_menu_item_below()}function select_menu_item(e){e.dom.querySelector("input").checked=!0,g0.selected_menu_item=e}function select_menu_item_below(){let e=g0.menu_items_matching_search.length>0?g0.menu_items_matching_search:menu_items;if(0===e.length)return;let t=e.indexOf(g0.selected_menu_item),r=e.length-1==t?0:t+1;t!==r&&(select_menu_item(e[r]),scroll_into_view_if_needed(g0.selected_menu_item.dom))}function select_menu_item_above(){let e=g0.menu_items_matching_search.length>0?g0.menu_items_matching_search:menu_items;if(0===e.length)return;let t=e.indexOf(g0.selected_menu_item),r=t<1?e.length-1:t-1;t!==r&&(select_menu_item(e[r]),scroll_into_view_if_needed(g0.selected_menu_item.dom),scroll_into_view_if_needed(g0.selected_menu_item.dom))}function start_edit_mode(e){leave_edit_mode(),edit_mode_active=!0,disable(el.search),disable(record_related_buttons),el.editor_po.showPopover(),el.editor.value=e.data.raw,enable(el.editor),el.editor.focus(),el.editor.initial_value=e.data.raw,enable(el.cancel_edit)}function set_record_value_to(e,t){if(!t||!e)return;let r=t.data;remove_record_data_to_db_collections(r);let _=task_line_to_db_object(e);return add_record_data_to_db_collections(_),Object.assign(r,_),mark_need_to_save(),t.dom.preview.textContent=make_record_preview_string(_),sort_records_on_dom__adds_any_not_added(),update_sidebars(),t}function apply_edits_to_selected_record(){if(1!==g0.selected_records.size)return;let e=get_first_set_item(g0.selected_records);if(!e)return;let t=el.editor.value.trim(),r=0==t.length,_=t==e.data.raw;r||_||(set_record_value_to(t,e),filter_records(),leave_edit_mode(),select_record_if_not_hidden(e))}function delete_record(e){remove_record_data_to_db_collections(e.data),update_sidebars(),g0.db.records.delete(e.data),e.dom.row.remove(),g0.selected_records.delete(e),mark_need_to_save(),g0.record_els.length=0,for_loop((e=>g0.record_els.push(e)))(document.getElementsByClassName("record")),filter_records()}function delete_any_selected_records(){g0.selected_records.forEach(delete_record),toggle_record_related_buttons_based_on_selection()}function escape_regex_string(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}on("keydown",(e=>{"Escape"===e.key&&(e.preventDefault(),clear_menu_items_searcher()),"Enter"===e.key&&(e.preventDefault(),g0.selected_menu_item&&(e.target.blur(),e.target.value="",g0.selected_menu_item.dom.click())),"ArrowDown"===e.key&&(e.preventDefault(),select_menu_item_below()),"ArrowUp"===e.key&&(e.preventDefault(),select_menu_item_above())}),el.menu_items_searcher),on("keydown",(e=>{"Escape"===e.key&&(e.preventDefault(),leave_edit_mode()),"Enter"===e.key&&(e.preventDefault(),apply_edits_to_selected_record())}),el.editor),on("input",(e=>{let t=el.editor.value,r=0===t.trim().length,_=t===el.editor.initial_value,o=r||_;el.apply_edit.disabled=o}),el.editor),on("click",apply_edits_to_selected_record,el.apply_edit),on("click",(()=>{delete_any_selected_records(),el.delete_dialog.close()}),el.delete_confirm),on("click",(()=>{el.delete_dialog.close()}),el.delete_cancel);const cut_all_instances_of_substring_from_string=(e,t)=>{let r=RegExp(`(?:^| )(${escape_regex_string(e)})(?= |$)`,"gi");return t.replace(r," ")},ADD_substring_in_records_search_query=e=>{let t=RegExp(`(?:^| )(${escape_regex_string(e)})(?: |$)`,"gi"),r=el.records_search_query;t.test(r.value)||(r.value+=(r.value.length>0?" ":"")+e)},CUT_substring_in_records_search_query=e=>{let t=el.records_search_query,r=t.value,_=cut_all_instances_of_substring_from_string(e,r);return _!==r&&(t.value=_.replaceAll("  "," ").trim(),!0)};function toggle_string_presence_in_records_search_query(e){CUT_substring_in_records_search_query(e)||ADD_substring_in_records_search_query(e),filter_records()}function fill_sidebar_list(e,t,r){t.innerHTML="";let _=0,o=("+"===r[0]?"p":"c")+"$";function s(e){toggle_string_presence_in_records_search_query(e.currentTarget.prefixed)}function n(e){strip_from_search_value_any_groups(),el.records_search_query.value+=" "+e.currentTarget.prefixed,el.records_search_query.value=el.records_search_query.value.replace(/\s{2,}/g," ").trim(),filter_records()}on("click",(e=>{e.target.closest("summary")&&"label"===e.target.tagName&&(e.preventDefault(),e.stopPropagation())}),t);let l=function(e){let t={};return Object.keys(e).forEach((r=>{let _=r.split("/"),o=t;_.forEach(((t,s)=>{o[t]||(o[t]={_children:{},_count:0}),s===_.length-1&&(o[t]._count=e[r]),o=o[t]._children}))})),t}(e),d=document.createDocumentFragment();return d.appendChild(function e(t,l){let d=new_el("ul");return Object.keys(t).sort().forEach((i=>{let a=t[i],c=l?`${l}/${i}`:i,u=new_el("li",d),f=Object.keys(a._children).length>0,g=function(e,t,l){let d=new_el("label"),i=new_el("input",d);return new_el("span",d).textContent=e,"+"==r?(i.type="radio",i.name="rg1",on("change",n,i)):(i.type="checkbox",on("change",s,i)),i.id=o+_++,i.prefixed=t,new_el("span",d).textContent=l,g0.prop_els.set(t,i),d}(i,`${r}${c}`,a._count);if(f){let t=new_el("details",u);t.open=!0,new_el("summary",t).appendChild(g),t.appendChild(e(a._children,c))}else u.appendChild(g)})),d}(l,"")),t.appendChild(d),t}function fill_sidebar_list__groups(){fill_sidebar_list(g0.db.groups,el.groups_list,"+")}function fill_sidebar_list__tags(){fill_sidebar_list(g0.db.tags,el.tags_list,"@")}function clear_records_search_query(){let e=el.records_search_query;0==e.value.length?e.blur():(e.value="",e.focus()),filter_records()}function strip_from_search_value_any_groups(){let e=el.records_search_query;e.value=e.value.replace(/(^|\s)\+[^\s]+/g,"").trim()}function strip_from_search_value_any_tags(){let e=el.records_search_query;e.value=e.value.replace(/(^|\s)@[^\s]+/g,"").trim(),filter_records()}function hide(e){e.classList.add("hide")}function show(e){e.classList.remove("hide")}on("click",clear_records_search_query,el.clear_records_search_query),on("click",(()=>{strip_from_search_value_any_groups(),filter_records()}),el.strip_from_search_value_any_groups),on("click",strip_from_search_value_any_tags,el.strip_from_search_value_any_tags),on("focus",(()=>leave_edit_mode()),el.records_search_query),on("input",(()=>{deselect_all_records(),filter_records(),select_first_record_shown_in_list()}),el.records_search_query),on("click",(()=>{CUT_substring_in_records_search_query("DONE"),CUT_substring_in_records_search_query("DO"),filter_records()}),el.show_state_any),on("click",(()=>{CUT_substring_in_records_search_query("DONE"),ADD_substring_in_records_search_query("DO"),filter_records()}),el.show_state_todo),on("click",(()=>{CUT_substring_in_records_search_query("DO"),ADD_substring_in_records_search_query("DONE"),filter_records()}),el.show_state_done);const idb=(()=>{const e="handles",t="2025_0417";let r=null;const _={open_db:()=>new Promise(((t,_)=>{const o=indexedDB.open("fileHandleDB",1);o.onupgradeneeded=t=>{const r=t.target.result;r.objectStoreNames.contains(e)||r.createObjectStore(e,{keyPath:"id"})},o.onsuccess=e=>{r=e.target.result,t()},o.onerror=e=>_(e.target.error)}))},o=(t,_)=>new Promise(((o,s)=>{const n=_(r.transaction(e,t).objectStore(e));n.onsuccess=()=>o(n.result),n.onerror=e=>s(e.target.error)}));return _.save_handle=(e,r)=>o("readwrite",(_=>_.put({id:t,handle:e,name:r}))),_.load_handle=()=>o("readonly",(e=>e.get(t))),_.delete_handle=()=>o("readwrite",(e=>e.delete(t))),_})(),fs={check_permission:async(e,t="readwrite")=>{const r={mode:t};return"granted"===await e.queryPermission(r)||"granted"===await e.requestPermission(r)}},set_file_status=e=>el.file_status.textContent=e,show_file_dialog=e=>{el.file_dialog_message.textContent=e,el.file_dialog.showModal()};on("click",(()=>{el.file_dialog.close()}),el.file_dialog_done_button),window.addEventListener("beforeunload",(e=>{g0.has_unsaved_changes&&e.preventDefault()}));const f_action={update_file_buttons:async()=>{const e=await idb.load_handle();[el.file_forget,el.file_save,el.file_save_as].forEach(e?enable:disable),e&&!g0.file_is_loaded?(show(el.file_load_stored),el.file_load_stored.textContent=`Reopen "${e.name}"`,disable(el.file_close)):(hide(el.file_load_stored),enable(el.file_close))},load_editor:async(e,t=null)=>{if(await f_action.file_close(),reset_app(),set_file_status("Reading file..."),!await fs.check_permission(e,"read"))throw Error("Read permission denied");const r=await e.getFile();if(!r.type.startsWith("text/"))return show_file_dialog("Not text file");restore(await r.text()),g0.has_unsaved_changes=!1,g0.file_is_loaded=!0,t&&set_file_status(`Loaded "${t}"`),await f_action.update_file_buttons()},save_content:async e=>{if(!await fs.check_permission(e))throw Error("Write permission denied");const t=await e.createWritable();let r=live_db_to_string_db();await t.write(r),await t.close(),set_file_status("File saved successfully."),g0.file_is_loaded=!0,g0.has_unsaved_changes=!1},file_save:async()=>{const e=await idb.load_handle();if(!e)return f_action.file_save_as();await fs.check_permission(e.handle)||set_file_status("Permission denied."),await f_action.save_content(e.handle),await f_action.update_file_buttons()},file_save_as:async()=>{const e=await window.showSaveFilePicker({types:[{description:"Text",accept:{"text/plain":[".txt"]}}]});if(!await fs.check_permission(e))return set_file_status("Permission denied.");const t=await e.getFile();await idb.save_handle(e,t.name),await f_action.save_content(e),await f_action.update_file_buttons()},file_select:async()=>{const[e]=await window.showOpenFilePicker();set_file_status("Saving file handle...");const t=(await e.getFile()).name;await idb.save_handle(e,t),await f_action.load_editor(e,t)},file_load_stored:async()=>{const e=await idb.load_handle().catch((e=>{console.log(e.message),console.log("Possibilities:\n- Tool hasn't setup the indexedDB (idb) yet\n- idb has no file stored to re-open\n- tool tried to open file before user page interaction")}));e&&(await fs.check_permission(e.handle,"read")||set_file_status("Permission not granted."),await f_action.load_editor(e.handle,e.name))},file_close:async()=>!(g0.has_unsaved_changes&&!confirm("You have unsaved changes. Close anyway?"))&&(reset_app(),set_file_status("File closed. Handle remains."),await f_action.update_file_buttons(),!0),file_forget:async()=>{f_action.file_close()&&(await idb.delete_handle(),set_file_status("Handle Forgotten."),await f_action.update_file_buttons())}},initial_indexedDB_and_file_access_api=async()=>{await idb.open_db(),await f_action.update_file_buttons();const e=await idb.load_handle();set_file_status(e?`Stored file found: "${e.name}"`:"No stored file. Open or Save As to begin.");["file_select","file_load_stored","file_close","file_forget","file_save","file_save_as"].forEach((e=>{el[e].onclick=f_action[e]}))};function update_visible_records_count_frontend(){let e=g0.db.records.size,t=e-el.records_list.querySelectorAll(".record.hide").length;el.visible_records.textContent=`${t}/${e}`}function filter_records(){g0.record_els_matching_search_filter.length=0;let e=el.records_search_query.value.trim();if(0===el.records_search_query.value.trim().length)return el.records_list.querySelectorAll(".record").forEach(show),update_visible_records_count_frontend(),g0.prop_els.forEach((e=>{e.checked=!1})),void disable(el.clear_records_search_query);enable(el.clear_records_search_query);let t=!1,r=!1,_=e.replace(/\b(DONE|DO)\b/g,((e,_)=>(console.log(_),"DONE"===_&&(r=!0),"DO"===_&&(t=!0),""))).replace(/ {2,}/," ").toLowerCase().trim();el.show_state_todo.checked=t,el.show_state_done.checked=r,el.show_state_any.checked=!r&&!t;let o=_.length>0,s=[],n=new Set,l=[];_.split(" ").forEach((e=>{tag_prefixes.has(e[0])?(n.add(e),l.push(e)):s.push(e)})),g0.prop_els.forEach(((e,t)=>{e.checked=n.has(t)})),el.records_list.querySelectorAll(".record").forEach((e=>{let _=e.record.data,n=!r||_.done,d=!t||!_.done,i=l.every((e=>_.lowTrimmed.includes(e))),a=!o||(1===s.length?_.lowTrimmed.includes(s[0]):s.every((e=>_.words.some((t=>t.startsWith(e))))));n&&d&&i&&a?(g0.record_els_matching_search_filter.push(e),show(e)):(hide(e),e.record.is_selected&&deselect_record(e.record))})),update_visible_records_count_frontend()}function scroll_into_view_if_needed(e){const t=e.getBoundingClientRect(),r=e.parentNode,_=r.getBoundingClientRect();let o=t.top<_.top;t.bottom>_.bottom?r.scrollTop+=t.bottom-_.bottom:o&&(r.scrollTop+=t.top-_.top)}function up_down_record_row_nav(e){let t=null,r={ArrowDown:select_record_below,ArrowUp:select_record_above}[e.key]||!1;r&&(e.preventDefault(),t=r(),t&&scroll_into_view_if_needed(t.dom.row))}on("click",add_new_record,el.add_new_record),on("keydown",(e=>{"Escape"===e.key&&(e.preventDefault(),clear_records_search_query()),"Enter"===e.key&&(e.preventDefault(),e.target.blur()),up_down_record_row_nav(e)}),el.records_search_query);let record_related_buttons=[el.show_delete_dialog,el.mark_done,el.mark_undone,el.deselect_all,el.edit_record,el.add_new_record,el.clone_record];function toggle_record_related_buttons_based_on_selection(){record_related_buttons.forEach(0===g0.selected_records.size?disable:enable),enable(el.add_new_record);let e=1===g0.selected_records.size?enable:disable;[el.clone_record,el.edit_record].forEach(e)}function deselect_all_records(){leave_edit_mode(),g0.selected_records.forEach(deselect_record),g0.selected_records.clear()}function deselect_record(e){if(!e)return console.log("pass deselect_record a record");e.dom.selector.checked=!1,g0.selected_records.delete(e),toggle_record_related_buttons_based_on_selection()}function record_is_hidden(e){return e.dom.row.classList.contains("hide")}function select_record_if_not_hidden(e){return e?!record_is_hidden(e)&&(g0.selected_records.add(e),e.dom.selector.checked=!0,void toggle_record_related_buttons_based_on_selection()):(console.log("pass select_record_if_not_hidden a record"),!1)}function get_first_set_item(e){return e.values().next().value}function get_el_list_to_search(){let e=g0.record_els_matching_search_filter;return e.length>0?e:g0.record_els}function select_record_above(){let e=get_el_list_to_search();if(0==e.length||0==e.size)return;let t=null;if(0===g0.selected_records.size)t=e[e.length-1];else{let r=find_first_index(e,(e=>e.record.is_selected));t=r-1<0?e[e.length-1]:e[r-1]}return deselect_all_records(),select_record_if_not_hidden(t.record),t.record}function select_first_record_shown_in_list(){let e=get_el_list_to_search();0!==e.length&&select_record_if_not_hidden(e[0].record)}function select_record_below(){let e=get_el_list_to_search();if(0==e.length||0==e.size)return;let t=null;if(0===g0.selected_records.size)t=e[0];else{let r=find_last_index(e,(e=>e.record.is_selected));t=r==e.length-1?e[0]:e[r+1]}return deselect_all_records(),select_record_if_not_hidden(t.record),t.record}function find_first_index(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r;return-1}function find_last_index(e,t){for(let r=e.length-1;r>=0;r--)if(t(e[r]))return r;return-1}function window_key_down(e){if(e.metaKey&&"p"===e.key)return e.preventDefault(),void show_main_menu_popover();e.ctrlKey||e.shiftKey||e.metaKey||("n"===e.key?(e.preventDefault(),add_new_record()):"f"===e.key?(e.preventDefault(),el.records_search_query.focus()):"x"===e.key?(e.preventDefault(),mark_selected_records_done()):"d"===e.key||"Backspace"===e.key?g0.selected_records.size>0?(e.preventDefault(),el.show_delete_dialog.click()):notify("Select a record to delete it"):"Enter"===e.key&&start_edit_mode_if_one_record_selected(),up_down_record_row_nav(e))}function enable_window_keydown_listener(){clearTimeout(g0.input_blur_timeout),g0.input_blur_timeout=setTimeout((()=>{on("keydown",window_key_down,window)}),200)}function disable_window_keydown_listener(){clearTimeout(g0.input_blur_timeout),window.removeEventListener("keydown",window_key_down)}on("click",(()=>{1===g0.selected_records.size&&start_edit_mode(get_first_set_item(g0.selected_records))}),el.edit_record),on("click",deselect_all_records,el.deselect_all),on("click",(()=>{el.delete_dialog.showModal(),el.delete_confirm.focus(),disable_window_keydown_listener()}),el.show_delete_dialog),on("close",(()=>{enable_window_keydown_listener()}),el.delete_dialog);const inputs=document.querySelectorAll("input, textarea");function mark_record_undone(e){if(!e)return;let t=e.data;t.done&&set_record_value_to(strip_first_date(t.raw).replace("x ",""),e)}function mark_record_done(e){if(!e)return;let t=e.data;t.done||set_record_value_to(`x ${get_stamp()}Z `+t.raw,e)}function mark_selected_records_done(){g0.selected_records.forEach(mark_record_done),filter_records()}function mark_selected_records_undone(){g0.selected_records.forEach(mark_record_undone),filter_records()}function set_notice(e){el.notice.textContent=e}function notify(e){set_notice(e),setTimeout((()=>{set_notice("")}),2e3)}function get_string_based_on_current_query(){let e=el.records_search_query.value.trim().split(" ").filter((e=>tag_prefixes.has(e[0]))).join(" "),t=e.length>0?" ":"";return get_stamp()+"A"+t+e+" "}function add_new_record({record:e}={}){let t=task_line_to_db_object(e?e?.data?.raw:get_string_based_on_current_query());g0.db.records.add(t),mark_need_to_save();let r=make_record_el__does_not_add_to_dom(t);return sort_records_on_dom__adds_any_not_added(),add_record_data_to_db_collections(t),update_sidebars(),filter_records(),e||(record_is_hidden(r)?notify("Clear the active search to see the new record"):(deselect_all_records(),select_record_if_not_hidden(r),start_edit_mode_if_one_record_selected())),r}function supports_file_access_api(){return"showOpenFilePicker"in window&&"showSaveFilePicker"in window}function live_db_to_string_db(){let e=[];return g0.db.records.forEach((t=>e.push(t.raw))),e.join("\n")}inputs.forEach((e=>{on("focus",disable_window_keydown_listener,e),on("blur",enable_window_keydown_listener,e)})),on("click",mark_selected_records_done,el.mark_done),on("click",mark_selected_records_undone,el.mark_undone),on("click",(()=>{add_new_record({record:get_only_selected_record_else_false()})}),el.clone_record),on("load",(async()=>{supports_file_access_api()?(await initial_indexedDB_and_file_access_api(),await f_action.update_file_buttons(),g0.file_is_loaded||load_example_db(),enable_window_keydown_listener(),setup_auto_save()):show(el.unsupported_browser)}),window);</script></body></html>