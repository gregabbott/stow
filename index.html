<!-- Merged 2025_07_15 -->
<html lang="en"><head><meta charset="UTF-8"><meta name="color-scheme" content="light dark"><link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiICB4PSIwIiB5PSIwIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj4KICA8c3R5bGU+LmF7CmZpbGw6IzI1MjUyNTsKZm9udC1mYW1pbHk6VmVyZGFuYTsKdGV4dC1hbmNob3I6bWlkZGxlOwp9PC9zdHlsZT4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI0ZGRiIvPjx0ZXh0IGNsYXNzPSJhIiBmb250LXNpemU9IjY4cHgiIHg9IjEwMCIgeT0iMTE2Ljg3NSI+U3RvdzwvdGV4dD48L3N2Zz4="><style>/* c.css */
:root {color-scheme: light dark;--light: hsl(0, 0%, 100%);--dark: hsl(0, 0%, 0%);--accent: #8e70f7;--rad: 1lh;}* {margin: 0;padding: 0;font-family: monospace;box-sizing: border-box;font-size: 15px;user-select: none;line-height: 100%;outline: none;border: none;}#theme_l:checked ~ .themeable {--bg: var(--light);--fg:  var(--dark);}#theme_d:checked ~ .themeable {--bg:  var(--dark);--fg:  var(--light);}#theme_a:checked ~ .themeable {--bg: light-dark(var(--light), var(--dark));--fg: light-dark(var(--dark), var(--light));}.themeable{--bs0: inset 0 0 0 .5px var(--fg);--bs: inset 0 0 0 1px var(--fg);--bs2: inset 0 0 0 2px var(--fg);--brd: 1px solid var(--fg);accent-color: var(--fg);* {color: var(--fg);}}label[for='theme_d'],label[for='theme_a'],label[for='theme_l']{display: none;}#theme_d:checked ~ * label[for='theme_a'],#theme_a:checked ~ * label[for='theme_l'],#theme_l:checked ~ * label[for='theme_d']{display: flex;}a{color: var(--fg);}hr{height: 1lh;}#notice{background-color: var(--fg);color: var(--bg);position: fixed;width: 100%;bottom: 0lh;left: 0ch;padding: .5em 1ch;text-align: left;display: block;}table{border-collapse: collapse;}select {background-color: var(--bg);color: var(--fg);border: var(--brd);padding: 0;font-family: 15px;line-height: 2lh;height: 1lh;padding: 0 1ch;-webkit-appearance: none;-moz-appearance: none;appearance: none;}.faux_po_holder{width: fit-content;height: fit-content;display: block;position: absolute;z-index: 4;}.faux_po_content {box-shadow: var(--bs);outline: var(--brd);outline-offset: -1px;background: var(--bg);overflow: hidden;position: fixed;display: flex;flex-direction: column;}#row_actions_po,#column_actions_po{.faux_po_content{margin: -.5px !important;padding: 0;width: 16ch;max-height: calc(100dvh - 2lh);overflow-y: auto;button {box-shadow: none;width: 100%;text-align: left;&:hover {background: var(--fg);color: var(--bg);}}}}#column_type_po .faux_po_content{width: 64ch;padding: 1lh 1ch;select {width: 100%;}}#filter_popover .faux_po_content{top: 1lh;left: 1ch;display: flex;#filter_switch{padding: .5em 1ch;width: 6ch;text-align: right;}gap: 0ch;align-items: center;#filter_query{width:40ch}#filter_name{width: 40ch;}label{height: 2lh !important;min-height: 2lh;position: relative;display: flex;align-items: center;gap: 1ch;width: 100%;box-shadow: var(--bs0);&:active,&:focus-within{b{font-weight: bold;}}b{width: 6ch;text-align: right;font-weight: normal;}padding: 0 1ch;input{padding: 0;box-shadow: none;}}}.faux_po_backdrop {position: fixed;top: 0;left: 0;background: var(--accent);opacity: 0.0;height: 100dvh;width: 100dvw;display: block;}.full_viewport_notice {position: fixed;background-color: var(--bg);color: var(--fg);padding: 2ch;top: 0;left: 0;height: 100dvh;width: 100dvw;z-index: 999;display: flex;flex-direction: column;align-items: center;justify-content: center;text-align: center;}:popover-open,dialog:open {display: flex;flex-direction: column;}[popover],dialog {outline: 2px solid var(--fg);outline-offset: 0px;border: none;left: 3ch;top: 2lh;padding: 2lh 3ch;max-height: calc(100dvh - 4lh);background-color: var(--bg);z-index: 9999;width: 64ch;max-width: calc(100dvw - 2ch);}button,input {margin: 0;border: none;}input {padding: 0 1ch;background-color: transparent;height: 2lh;&[type="search"] {box-shadow: var(--bs);}outline: 0;&:focus {box-shadow: inset 0 0 0 2px var(--fg);}}button,.button {padding: 0 1ch;display: flex;align-items: center;box-shadow: inset 0 0 0 1px var(--fg);height: 2lh;background-color: var(--bg);color: var(--fg);border: none;&:active {background: var(--fg);color: var(--bg);}}html,body {height: 100dvh;max-height: 100dvh;margin: 0;overflow: hidden;}.themeable {color: var(--fg);background-color: var(--bg);display: flex;flex-direction: column;padding: 1lh 0 0;min-height: 100dvh;max-height: 100dvh;height: 100dvh;}main {display: flex;flex-grow: 1;overflow: hidden;}#menu_items {display: flex;flex-direction: column;}.new_column_strip {position: absolute;display: block;height: 100dvh;right: -1px;z-index: 999;width: 2px;background-color: var(--fg);cursor: pointer;}::-webkit-scrollbar {font-family: monospace;width: 1ch;height: 1lh;cursor: pointer;background-color: transparent;}::-webkit-scrollbar-thumb {background: transparent;border-radius: 0;box-shadow: inset 0 0 0 1px var(--fg);border: none;}::-webkit-scrollbar-track,::-webkit-scrollbar-corner {background: transparent;}#show_grid:checked ~ * label[for="show_grid"]{box-shadow: var(--bs2);}body:has(#show_grid:checked) .themeable{background-image:linear-gradient(to right,hsla(0, 0%, 50%, 0.1) 1px,transparent 1px),linear-gradient(to bottom,hsla(0, 0%, 50%, 0.1) 1px,transparent 1px);background-size: 1ch 1lh;background-position: -.5px -.5px;}nav {display: flex;min-height: 2lh;padding: 0 1ch;gap: 1ch;margin-bottom: 1lh;.grow {flex-grow: 1;}}g-db {height: 100%;width: 100%;display: flex;flex-direction: column;#table_holder {display: flex;align-items: start;flex-direction: column;flex: 0 1 auto;overflow-x: scroll;overflow-y: scroll;position: relative;width: 100%;height: 100%;background-color: transparent;max-width: 100%;padding: 0 1ch 50dvh;table {box-sizing: border-box;margin: 0;padding: 0;flex-grow: 0;width: auto;height: auto;display: table;table-layout: auto;border-collapse: collapse;border-spacing: 0;border: none;position: relative;&::after{content: "";position: absolute;top: .5px;left: 0px;outline-offset: -.5px;display: block;width: calc(100%);height: calc(100% - .5px);z-index: 3;outline: 1px solid var(--fg);pointer-events: none;}caption {background: var(--bg);outline: 1px solid var(--fg);outline-offset: -.5px;padding: .5em 1ch;}caption,thead{top: 0;position: sticky;z-index: 3;}th {width: 6ch;min-width: 6ch;max-width: 6ch;text-align: right;font-weight: normal;}th,td {background-color: var(--bg);outline: 1px solid var(--fg);outline-offset: -.5px;height: 2lh;white-space: pre-wrap;vertical-align: top;padding:calc(.5em)calc(1ch);line-height:1em;position: relative;min-width: calc(3ch - 1px);max-width: 66ch;}td{&:hover, &.selected {z-index: 1;outline-style: solid;outline-width: 1.5px;}}thead {top:2lh;&::after{width: 100%;height: 1px;position: absolute;z-index: 1;bottom: -0.5px;content: "";left: 0;display: block;background-color: var(--fg);}th,td{background-color: var(--bg);}tr:first-of-type td {cursor: context-menu;}}tbody {background-color: #8e70f7;counter-reset: row;input[type="checkbox"] {max-height: 1ch;max-width: 1ch;border: none;}tr {counter-increment: row;th:first-of-type {text-align: right;&::after {box-sizing: border-box;content: counter(row);}}&.selected>th:first-of-type::after {content: counter(row);width: calc(100%);height: 100%;padding: .5em 1ch;border-left: 1ch solid var(--fg);position: absolute;left: 0;top: 0;}th:first-of-type {cursor: context-menu;}}}}}}#db_thead tr:first-of-type td:hover::before,[title]::before,[data-t]::before{pointer-events: none;position: fixed;bottom: 0px;font-weight: normal;left: 1ch;display: flex;width: 100dvw;height: 2lh;background: var(--bg);color: var(--fg);text-align: left;text-transform:none;align-items: center;justify-content: left;z-index: 9999;}#db_thead tr:first-of-type td:hover::before{content: attr(data-note);}[data-t]:hover::before{content: attr(data-t);}[title]:hover::before{content: attr(title);}#filter_row td[title]{background-color: var(--fg);color: var(--bg);}#filter_row td[title]::after{position: absolute;content: attr(title);white-space: nowrap;max-width: calc(100% - 2ch);left: 1ch;overflow: hidden;text-overflow: ellipsis;}.x,.y {display: flex;gap: 1ch;}x{align-content: center;}.y{flex-direction: column;}#compact_mode:checked ~ * {label[for="compact_mode"]{box-shadow: var(--bs2);}thead {top:1lh;}caption {padding: 0em 1ch;}#db_table tr {th, td {padding: 0em 1ch;height: 1lh;}&.selected>th:first-of-type::after {padding-top: 0;}}}body:has(:popover-open) {#hide_popover {display: block;}}::backdrop {opacity: 0;}#hide_popover{z-index: 99;display: none;background: var(--dark);opacity: 0;width: 100dvw;content: "";height: 100dvh;position: fixed;top: 0;left: 0;}.hide {display: none !important;}#prompt_po {padding: 0;p{padding: .5em 1ch;border-bottom: 1px dashed var(--fg);}textarea {box-shadow: none;border-bottom: var(--brd);width: 100%;font-size: 1lh;height: 4lh;padding: .5lh 1ch;line-height: 100%;margin: 0;resize: none;background-color: var(--bg);}.x {gap: 0;button {width: 16ch;outline: var(--brd);box-shadow: none;&:hover{font-weight: bold;}text-align: center;}padding: 0lh 0ch;}}#main_menu_po {padding: 0;overflow: hidden;#menu_items_searcher {width: 100%;display: block;padding: 1ch;box-shadow: none;border-bottom: var(--brd);}footer {border-top: var(--brd);min-height: 2lh;display: flex;align-items: center;padding: 0 1ch;text-align: center;}#menu_items {max-height: 50dvh;overflow-y: auto;&::-webkit-scrollbar {width: 2ch;height: 1ch;cursor: pointer;}&::-webkit-scrollbar-thumb {background: var(--bg);border-radius: 0;box-shadow: inset 0 0 0 1px var(--fg);border: none;border-right: 1ch solid var(--bg);}gap: 0;div {display: flex;align-items: center;min-height: 2lh;padding: 0 1ch;border: 1px dotted transparent;border-left: none;border-right: none;&:hover {border-color: var(--fg);}input {display: none;padding: 0;margin: 0;}&:has(input:checked) {font-weight: bold;}button {all: unset;cursor: default;padding: 0;height: auto;border: none;&:hover,&:focus {box-shadow: none;outline-color: transparent;}&:active {background-color: var(--bg);color: var(--fg);}}}}}#file_load_stored {box-shadow: inset 0 0 0 2px var(--fg);&:focus,&:hover {outline: none;background: var(--fg);color: var(--bg);}}.crossed,:disabled,.disabled{position: relative;overflow: hidden;color: transparent;&:before,&:after{content: '';position: absolute;top: 50%;left: 50%;width: 150%;height: 1px;background-color: var(--fg);transform: translate(-50%,-50%) rotate(45deg);}&:after{transform: translate(-50%,-50%) rotate(-45deg);}}:disabled,.disabled {cursor:not-allowed;pointer-events: none;}.active_col{font-weight: bold;}</style><style id="column_styles"></style><!-- STOW. By + copyright 2025 Greg Abbott--><title>Stow</title></head><body><input hidden="" type="radio" name="theme" id="theme_l"><input hidden="" type="radio" name="theme" id="theme_d"><input hidden="" type="radio" name="theme" id="theme_a" checked=""><div class="themeable"><input type="checkbox" id="compact_mode" hidden=""><input type="checkbox" id="show_grid" checked="" hidden=""><div popover="" id="po_license"><p>Name: <span data-t="To carefully and neatly arrange and pack items in a compact mass, and store them in their proper place">Stow</span><br>
Version: 2025_0526<br>
View: <a href="log.html">Change Log</a><br>
By: <a href="https://gregabbott.pages.dev/">Greg Abbott</a></p><hr><p>LICENSE<br>
© 2025 Greg Abbott. All rights reserved.</p><p>NO WARRANTY<br>
THE SOFTWARE IS PROVIDED "AS IS",
WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE
AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</p></div><noscript><div class="full_viewport_notice"><p>This tool requires JavaScript<br><a href="https://gregabbott.pages.dev/">View other tools</a></p></div></noscript><div id="unsupported_browser" class="full_viewport_notice hide"><div><p>Your browser doesn't support the File Access API.<br>
This tool uses it to edit local files.</p><p><a href="https://gregabbott.pages.dev/">View other tools</a></p></div></div><div id="main_menu_po" popover=""><input type="search" id="menu_items_searcher"><div id="menu_items"><div id="new_db"><input type="radio" name="mi"><button>New</button></div><div id="file_select"><input type="radio" name="mi"><button>Open File</button></div><div id="file_close"><input type="radio" name="mi"><button>Close File</button></div><div id="file_forget"><input type="radio" name="mi"><button>Forget File</button></div><div id="file_save"><input type="radio" name="mi"><button>Save File</button></div><div id="file_save_as"><input type="radio" name="mi"><button>Save As File</button></div><div id="show_po_license"><input type="radio" name="mi"><button>Read License</button></div><div id="copy_db_as_json"><input type="radio" name="mi"><button>Copy DB as JSON</button></div></div><footer><div id="file_status"></div></footer></div><div id="filter_popover" class="faux_po_holder hide"><div id="filter_popover_hide" class="faux_po_backdrop"></div><div class="faux_po_content" data-t="Optionally use JS `/RegularExpressions/gi` to search (e.g. `/[a-z]\d{4}$/i`)"><datalist id="filter_tokens"><option value="&quot;Is Blank&quot;"></option><option value="&quot;Not Blank&quot;"></option></datalist><div id="filter_switch" data-t="Click to toggle this filter on or off">Flip</div><input id="filter_query" list="filter_tokens" type="search"></div></div><div id="column_type_po" class="faux_po_holder hide"><div id="column_type_po_hide" class="faux_po_backdrop"></div><div class="faux_po_content"><p>Tweak <span id="column_type_current_column_name"></span> column data type</p><select id="column_type_picker"><option data-t="Convert new input to the most likely type (Number, Boolean, Null, String)">any</option><option data-t="Keep new inputs as strings">string</option><option data-t="Convert new input to a number where possible (e.g. &quot;8&quot; -&gt; 8)">number</option><option data-t="Accept [true, false, null]">boolean</option></select></div></div><dialog id="file_dialog"><p id="file_dialog_message"></p><menu><button id="file_dialog_done_button">done</button></menu></dialog><div id="row_actions_po" class="faux_po_holder hide"><div id="row_actions_po_hide" class="faux_po_backdrop"></div><div class="faux_po_content"><div><button id="record_make_above">Make Above</button></div><div><button id="record_make_below">Make Below</button></div><div><button id="record_delete_all_ticked">Zap ticked rows</button></div><div><button id="record_delete_clicked">Zap row</button></div><div><button id="record_clone">Clone</button></div><div data-t="Copy row as JSON"><button id="record_copy_as_js_ob">Copy JSON</button></div></div></div><div id="column_actions_po" class="faux_po_holder hide"><div id="column_actions_po_hide" class="faux_po_backdrop"></div><div class="faux_po_content"><div><button id="column_rename" data-t="Rename this column">Name</button></div><div><button id="column_tweak_note">Note</button></div><div><button id="column_tweak_type">Type</button></div><div><button id="column_delete">Zap</button></div><div><button id="column_sort_a_z">Sort A-Z</button></div><div><button id="column_sort_z_a">Sort Z-A</button></div><div><button id="column_move_left">Move Left</button></div><div><button id="column_move_right">Move Right</button></div><div><button id="column_add_before">Add Left</button></div><div><button id="column_add_after">Add Right</button></div></div></div><div id="prompt_po" class="faux_po_holder hide"><div id="prompt_po_hide" class="faux_po_backdrop"></div><div class="faux_po_content"><p id="prompt_message"></p><textarea id="prompt_input"></textarea><div class="x"><button id="insert_date" data-t="Insert current date time stamp yyyy_MMdd_hhmm">Stamp</button><button id="prompt_button_yes" data-t="Apply">Keep</button><button id="prompt_button_no" data-t="Cancel">Shut</button></div></div></div><mark></mark><nav><button id="show_main_menu_po">Menu</button><div class="x"><label class="button" for="compact_mode" data-t="Toggle the table's vertical cell padding">Cram</label><label class="button" for="show_grid" data-t="Toggle grid visibility">Rule</label></div><div id="scroll_to_top" class="button hide" data-t="Scroll to top">Rise</div><button id="file_load_stored" data-t="Reopen remembered file from previous session">Reopen</button><div><label class="button" for="theme_l" data-t="Current mode: System. Click to Activate Light Mode">Flip</label><label class="button" for="theme_d" data-t="Current mode: Light. Click to Activate Dark Mode">Flip</label><label class="button" for="theme_a" data-t="Current mode: Dark. Click to Activate System Mode (Light / Dark)">Flip</label></div><div class="pagination_items x"><div data-t="Rows Per Page"><select id="page$rows_each"><option>5</option><option selected="">10</option><option>50</option><option>100</option><option>500</option><option>1000</option></select></div><button id="page_left">&lt;</button><span id="page_number">1</span>/<span id="page_total">1</span><button id="page_right">&gt;</button></div><div class="grow"></div><div id="facts"><span data-t="Current Saved Status" id="current_saved_status">Unsaved</span> | <span data-t="Records shown that match active filters">Hits <span id="record_facts$filter_matches">N</span></span> | <span data-t="Records / rows in database">Rows <span id="record_facts$total">N</span></span></div><div id="notice" class="hide">Notice</div></nav><main><g-db><div id="table_holder"><table id="db_table"><caption id="db_name"></caption><thead id="db_thead"></thead><tbody id="db_tbody"></tbody></table></div></g-db></main><dialog id="confirm_dialog"><p id="confirm_message"></p><div id="confirm_buttons" class="x"><button id="confirm_button_no">No</button><button id="confirm_button_yes" autofocus="">Yes</button></div></dialog><div id="hide_popover"></div></div><script>/* make_table.js */
function make_table({meta:e,columns:t,records:n,on_insert_row:l,on_delete_row:r}){let o=t.map((e=>({...e}))),c=[],i=new Map,s=!1,a=new Map;function _(){s&&(a.clear(),c.forEach(((e,t)=>{a.set(e,t)})))}function d(){c.length>=1e3&&!s?(s=!0,_()):c.length<1e3&&s&&(s=!1,a.clear())}function u(e){let t=function(e){let t=[...e];return o.forEach(((e,n)=>{void 0===t[n]&&Object.prototype.hasOwnProperty.call(e,"seed")&&(t[n]=e.seed)})),t}(e);return t.id=Symbol(),t}function f(e,t){let n=u(t);return c.splice(e,0,n.id),i.set(n.id,n),d(),_(),l&&l(n),n}function g(e){return s?a.get(e.id):c.indexOf(e.id)}function p(e,t){let[n]=c.splice(e,1);c.splice(t,0,n),_()}const h={add:e=>f(c.length,e),insert_a_before_b:(e,t)=>f(g(t),e),insert_a_after_b:(e,t)=>f(g(t)+1,e),move_up(e){let t=g(e);t>0&&p(t,t-1)},move_down(e){let t=g(e);t>=0&&t<c.length-1&&p(t,t+1)},move_before(e,t){let n=g(e),l=g(t);n>=0&&l>=0&&n!==l-1&&p(n,l)},move_after(e,t){let n=g(e),l=g(t);n>=0&&l>=0&&n!==l+1&&p(n,l+1)},delete(e){let t=g(e);t>=0&&(c.splice(t,1),i.delete(e.id),d(),_(),r&&r(e))},get_all:()=>c.map((e=>i.get(e))),filter(e){const t=[];for(const n of c){const l=i.get(n);e(l)&&t.push(l)}return t},get_index:e=>g(e),get_by_index(e){let t=c[e];return i.get(t)},get size(){return c.length},get length(){return c.length}};function b(e,t){let[n]=o.splice(e,1);o.splice(t,0,n),h.get_all().forEach((n=>{let[l]=n.splice(e,1);n.splice(t,0,l)}))}const m={add(e){let t={...e};o.push(t);let n=t&&Object.prototype.hasOwnProperty.call(e,"seed")?e.seed:null;return h.get_all().forEach((e=>{e.push(n)})),t},insert_before({index:t,object:n}){let l={...n};o.splice(t,0,l);let r=l&&Object.prototype.hasOwnProperty.call(l,"seed")?e.seed:null;return h.get_all().forEach((e=>{e.splice(t,0,r)})),l},insert_after:({index:e,object:t})=>m.insert_before({index:e+1,object:t}),move_a_before_b(e,t){b(e,t)},move_a_after_b(e,t){b(e,t+1)},move_left(e){e<=0||b(e,e-1)},move_right(e){e>=o.length-1||b(e,e+1)},delete(e){o.splice(e,1),h.get_all().forEach((t=>t.splice(e,1)))},get_all:()=>o,get_index:e=>o.indexOf(e),get_by_index:e=>o[e],get size(){return o.length}};return n.forEach(h.add),{meta:e,column:m,record:h,sort_records:function({column_index:e,reverse:t=!1}){c.sort(((n,l)=>{let r=i.get(n)[e],o=i.get(l)[e];return r<o?t?1:-1:r>o?t?-1:1:0})),_()},display_table:function(){console.log({columns:o,rows:h.get_all()})},_useMapping:()=>s,_rowIdToIndex:()=>a}}
/* j.js */
const g0={};(()=>{const e=[...document.querySelectorAll('[id]:not([id=""])')].reduce(((e,t)=>(e[t.id.trim()]=t,e)),{});function t(){g0.page={total:1,current:1},g0.db={},g0.record_els_matching_search_filters=[],g0.menu_items_matching_search=[],g0.selected_menu_item=null,g0.column_active_index=null,g0.row_to_act_on=null,e.filter_row=null,g0.trs_selected=new Set,g0.selected_cells=new Set,g0.file_is_loaded=!1,g0.has_unsaved_changes=!1,g0.last_saved_content="",g0.confirm_yes_fn=null,g0.confirm_no_fn=null,g0.prompt_yes_fn=null,g0.prompt_no_fn=null,g0.prompt_pending=!1}function n(e){return Array.from({length:e},(()=>""))}function o({clicked:e,str:t,pass_fn:n,fail_fn:o}){navigator.clipboard.writeText(t).then((()=>{n&&n()})).catch((e=>{o&&o()}))}function l(e){let t=new Set;e.forEach((e=>{Object.keys(e).forEach((e=>t.add(e)))}));let n={};return t.forEach((t=>{let o=[];e.forEach((e=>{o.push(void 0!==e[t]?e[t]:null)})),n[t]=o})),n}function r(){g0.has_unsaved_changes=!0,e.current_saved_status.textContent="Unsaved",g0.allow_auto_save=!0}function i(){g0.has_unsaved_changes=!1,e.current_saved_status.textContent="Saved"}t();function a(e,t){let n=document.createElement(e);return t?t.appendChild(n):n}function c(e,t,n){return n?(n.removeEventListener(e,t),n):n=>c(e,t,n)}function s(e,t,n){return n?(n.addEventListener(e,t),n):n=>s(e,t,n)}function d(e="any",t){if("string"===e)return t;let n=(e=>{try{let t=JSON.parse(e);return null===t||!0===t||!1===t||"number"==typeof t?t:e}catch(t){return e}})(t);return"any"===e?n:0===t.trim().length||null===n?null:typeof n!==e?(Ce(`Input "${t}" won't convert to column type '${e}'.`),t):n}function _(e=new Date){const t=["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],n=["Y","M","d","h","m","s","u"].reduce(((n,o,l)=>{return n[o]=(e[r="get"+t[l]]()+("getMonth"===r)+"").padStart("getMilliseconds"===r?3:2,"0"),n;var r}),{});return n.c=n.Y.substring(0,2),n.y=n.Y.substring(2),n}function u(e=new Date){let t=_(e);return"Y_Md_hm".split("").map((e=>t[e]||e)).join("")}function f(){t(),e.db_name.innerHTML="",e.db_thead.innerHTML="",e.db_tbody.innerHTML=""}function m(){let t={},n={};g0.record_els_matching_search_filters.length=0;let o=[...e.filter_row.querySelectorAll("td")].reduce(((e,o,l)=>{let r=o.column;if(!r.sift||null==r.find||0===r.find.length)return e;if('"Is Blank"'===r.find)return e.set(l,t),e;if('"Not Blank"'===r.find)return e.set(l,n),e;let i=function(e){if(!function(e){return e.length>1&&e.startsWith("/")&&/\/(gi|i|g|ig)?$/.test(e)}(e))return!1;let{exp:t,flags:n=""}=e.match(/\/(?<exp>.*)\/(?<flags>gi|i|g|ig)?$/)?.groups;try{return RegExp(t,n)}catch(e){return!1}}(r.find);if(!1!==i)return e.set(l,i),e;let a=r.find.toLowerCase();return e.set(l,a.split(" ")),e}),new Map);if(0===o.size)return void W(g0.db.record.get_all());let l=[...o];W(g0.db.record.filter((e=>{let o=!0,r=null,i=null;for(const[a,c]of l)if(r=e[a],i=r+"",c instanceof RegExp){if(!c.test(i)){o=!1;break}}else if(c===t){if(null!==r&&i.trim().length>0){o=!1;break}}else if(c===n){if(null===r||0===i.trim().length){o=!1;break}}else if(1===c.length){if(0==i.toLowerCase().includes(c[0])){o=!1;break}}else{let e=i.toLowerCase().split(" ");if(!1===c.every((t=>e.some((e=>e.startsWith(t)))))){o=!1;break}}return o})))}function g(e=""){return g0.db.meta.last=u(),function(e,t="\t"){if(n=e,!n||"object"!=typeof n||Array.isArray(n)||n instanceof Date)throw Error("give custom_stringify an object literal");var n;const o=new Set;function l(e,n=1){if(null==e)return JSON.stringify(e);if("function"!=typeof e&&"symbol"!=typeof e&&void 0!==e){if(Array.isArray(e)){const o=e.some((e=>e&&"object"==typeof e));if(o){const o=t.repeat(n);return`[\n${e.map((e=>t.repeat(n+1)+(l(e,n+1)??"null"))).join(",\n")}\n${o}]`}return`[${e.map((e=>l(e,n)??"null")).join(",")}]`}if("object"==typeof e){if(o.has(e))throw new TypeError("Converting circular structure to JSON");o.add(e);const r=t.repeat(n),i=t.repeat(n+1),a=Object.entries(e).map((([e,t])=>{const o=l(t,n+1);return void 0===o?void 0:`${i}"${e}": ${o}`})).filter(Boolean);return o.delete(e),`{\n${a.join(",\n")}\n${r}}`}return JSON.stringify(e)}}const r=Object.entries(e).map((([e,n])=>{const o=l(n,1);return void 0===o?void 0:`${t}"${e}": ${o}`})).filter(Boolean);return`{\n${r.join(",\n")}\n}`}({meta:g0.db.meta,form:l(g0.db.column.get_all()),list:g0.db.record.get_all()},e)}function p(e){return e.name??="",e.note??="",e.seed??="",e.type=function(e){let t="boolean",n="number",o="any",l="string",r=typeof e===l,i=(e,t)=>typeof e===l&&typeof t===l&&0!==e.length&&0!==t.length&&e.startsWith(t);return r&&(e=e.toLowerCase()),"*"===e||"a"===e||e===o||null===e?o:typeof e===t||"?"===e||"true"===e||"false"===e||i(t,e)?t:typeof e===n||i(n,e)?n:r?l:o}(e.type),void 0===e.sift&&(e.sift=1),1==e.sift&&(e.sift=1),0==e.sift&&(e.sift=0),e.find??="",e}function h(e){var t;e.form&&(null!==(t=e.form)&&"object"==typeof t&&!Array.isArray(t))&&(e.form=function(e){const t=Object.keys(e),n=Math.max(...Object.values(e).map((e=>e.length)));return Array.from({length:n},((n,o)=>t.reduce(((t,n)=>(t[n]=e[n][o]||null,t)),{})))}(e.form));let o=e.list?.[0]?.length;if(0===o&&e.form&&(o=e.form.length||0),o<1){let e="Input doesn't have expected data.\ne.g. {\"form\":{name:[c1v,c2v],…},\"list\":[['a1','b1,],…]}";return Ce(e),void console.error(e)}if(null==e.form&&(e.form=[]),0==e.form.length||e.form.length<o)for(;e.form.length<o;)e.form.push({name:"",note:"",type:"any",sift:!1,find:""});var l;return null!=e.list&&0!==e.list.length||(e.list=[n(o)]),e.form=e.form.map(p),g0.db=make_table({meta:(l=e.meta,l?(void 0===l.name&&(l.name="Untitled DB"),void 0===l.made&&(l.made=u()),void 0===l.note&&(l.note=""),l):{name:"Untitled DB",note:"",made:u()}),columns:e.form,records:e.list}),g0.db}function y(e){if(!e||0===e.size)return null;for(const t of e)return t}function w(e,t){s("contextmenu",(function(t){t.preventDefault(),s("mouseup",(function t(n){n.preventDefault(),e(n),c("mouseup",t,document)}),document)}),t)}function b(t){const n=t.target.closest("tr");n&&(g0.row_to_act_on=n,function(t){g0.trs_selected.size>1&&g0.trs_selected.has(g0.row_to_act_on)?(ce(e.record_delete_all_ticked),ae(e.record_delete_clicked)):(ae(e.record_delete_all_ticked),ce(e.record_delete_clicked));ce(e.row_actions_po),L({event:t,element:e.row_actions_po.querySelector(".faux_po_content")})}(t))}function v(){ge(),g0.selected_cells.size>0&&g0.selected_cells.forEach((e=>{e.classList.remove("selected")})),g0.selected_cells.clear()}function x(t){g0.selected_cells.add(t),t.classList.add("selected");let n=t.parentNode;n.classList.add("selected"),g0.trs_selected.add(n);let o=e.column_names.querySelectorAll("td"),l=-1,r="active_col";for(let e of t.parentNode.querySelectorAll("td"))l++,e==t?o[l].classList.add(r):o[l].classList.remove(r)}function S(e){let t=a("tr");t.className="record";a("th",t);return e.forEach((e=>{a("td",t).textContent=e})),t.record=e,t}function k(){let e=g0.row_to_act_on;return e||(e=y(g0.selected_cells)?.parentNode),e}function C({above:t}){let n=k(),o=function(){let t=[];return e.filter_row.querySelectorAll("td").forEach((e=>{let n=e.column.seed;if(1===e.column.sift){let t=e.column.find.trim();t.length>0&&(t.length>2&&'"'==n[0]&&t.endsWith('"')||(n=t))}t.push(n)})),t}();n?o=(t?g0.db.record.insert_a_before_b:g0.db.record.insert_a_after_b)(o,n.record):(console.log("addToEnd"),o=g0.db.record.add(o)),r(),m();let l=null;for(let t of e.db_tbody.querySelectorAll("tr"))if(t.record===o){l=t;break}return l?ge():Ce("Record added. May appear on another page or mismatch current filters"),l}function A(){let t=g0.row_to_act_on;t||console.log("record_copy_as_js_ob no row to act on");let n=t.record,l=[];e.column_names.querySelectorAll("td").forEach(((e,t)=>{let o=n[t];"string"==typeof o&&(o=`"${o}"`),l.push(`"${e.column.name}":${o}`)})),o({str:`{\n${l.join(",\n")}\n}`,pass_fn:()=>Ce("Copied row as JSON"),fail_fn:()=>Ce("Failed to row as JSON")})}function E(){let t=g0.row_to_act_on;if(!t)return void Ce("Select a record to clone then try again");let n=t.record;!function(t,n=!1){let o=k();o?(e.db_tbody.insertBefore(t,o),!1===n&&e.db_tbody.insertBefore(o,t)):e.db_tbody.insertBefore(t,e.db_tbody.firstChild)}(S(g0.db.record.insert_a_after_b(JSON.parse(JSON.stringify(n)),n))),ge(),r()}s("click",(function(){o({str:g(""),pass_fn:()=>Ce("Copied DB as JSON"),fail_fn:()=>Ce("Failed to copy DB as JSON")})}),e.copy_db_as_json),s("click",(async()=>{let e=!0;if(g0.file_is_loaded){if(!await ue.file_close())return;e=!1}xe.prompt({message:"Wanted column names (Comma Separate)",initial:"A,B,C",yes_fn:t=>{e&&f();let o=t.split(",");h({meta:{name:"Untitled Doc",made:u(),note:""},form:{name:o},list:[n(o.length)]}),J(),r()},no_fn:()=>{Ce('Cancelled "Make New DB"')},y_text:"Make",n_text:"Stop"})}),e.new_db),w(b,e.db_tbody),s("click",(function(t){const n=t.target.closest("tr");if(!n)return;n.record;t.target===n.firstChild?b(t):g0.trs_selected.has(n)&&1===g0.trs_selected.size&&1===g0.selected_cells.size&&t.target===y(g0.selected_cells)?(!function(t){L({event:t,element:e.prompt_po.querySelector(".faux_po_content")})}(t),oe()):(ge(),v(),"TD"==t.target.tagName&&x(t.target))}),e.db_tbody),document.querySelectorAll(".faux_po_backdrop").forEach((e=>{w((e=>{e.target.click()}),e)}));let T={};function N(){return e.column_names.querySelectorAll("td")[g0.column_active_index].column}function q(e){let t=e.closest("tr").querySelectorAll("td"),n=-1;for(let o=0;o<t.length;o++)if(t[o]===e){n=o;break}return n}function L({event:e,element:t}){const{clientX:n,clientY:o}=e;let{offsetWidth:l,offsetHeight:r}=t;const i=window.innerWidth,a=window.innerHeight;let c=n+l+3>i,s=o+r+3>a,d=c?Math.max(n-l-3,0):n+3,_=s?Math.max(a-r-3,0):o+3,u=D(d,Ae,c),f=D(_,Ee,s);t.style.left=u+"px",t.style.top=f+"px"}function D(e,t,n){return Math[n?"floor":"ceil"](e/t)*t}function $(t){g0.column_active_index=q(t.target);t.target;let n=e.column_actions_po;ce(n),L({event:t,element:n.querySelector(".faux_po_content")})}function M(){let t=[];e.column_names.querySelectorAll("td").forEach(((e,n)=>{const o=n+1;"number"===e.column.type&&t.push(`\n        #db_table td:nth-of-type(${o}) {\n          text-align: right;\n        }\n      `)})),e.column_styles.innerHTML=t.join("\n")}T.move=({left:t,thenFn:n})=>{let o=t,l=!t;if(o&&0==g0.column_active_index)Ce("Already left-most");else if(l&&g0.column_active_index===e.column_names.querySelectorAll("td").length-1)Ce("already right-most");else{let a=g0.column_active_index;if(o)g0.db.column.move_left(a);else{if(!l)return;g0.db.column.move_right(a)}function i(e){let t=e.querySelectorAll("td")[a+l];e.insertBefore(t,t.previousElementSibling)}console.log({before_move_idx:a,cols:g0.db.column.get_all()}),e.db_thead.querySelectorAll("tr").forEach(i),e.db_tbody.querySelectorAll("tr").forEach(i),r()}n&&n()},T.tweak_type=()=>{let t=N(),n=t.name.trim();e.column_type_current_column_name.textContent=n.length<1?'"Untitled Column"':`"${n}"`,e.column_type_picker.value=t.type,ce(e.column_type_po)},s("input",(()=>{N().type=e.column_type_picker.value,r(),M()}),e.column_type_picker),s("click",(t=>{ae(e.column_type_po)}),e.column_type_po_hide),s("click",(t=>{ae(e.prompt_po)}),e.prompt_po_hide),T.tweak_note=()=>{let t=e.column_names.querySelectorAll("td")[g0.column_active_index],n=t.column;xe.prompt({message:`Tweak Note for "${n.name}"`,initial:n.note,yes_fn:e=>{null===e&&console.log("No value returned"),t.dataset.note=e,n.note=e,r()},no_fn:()=>{Ce('Stopped "Edit Column Note"')}})},T.rename=()=>{let t=e.column_names.querySelectorAll("td")[g0.column_active_index],n=t.textContent;xe.prompt({message:`Rename Column "${n}"`,initial:n,yes_fn:e=>{t.column.name=e,t.textContent=e,r()},no_fn:()=>{Ce('User cancelled "Rename Column"')}})},T.sort=({reverse:e=!1})=>{let t=g0.column_active_index;xe.confirm({text:`Sort "${g0.db.column.get_by_index(t).name}" Column (${e?"Z-A":"A-Z"})\n(No 'undo' available afterwards)`,yes_fn:()=>{g0.db.sort_records({column_index:t,reverse:e}),m(),r()},no_fn:()=>{Ce("Cancelled 'Sort Column'")}})},T.delete=()=>{if(e.column_names.querySelectorAll("td").length<2)return void Ce("Table needs at least 1 Data Column");let t=g0.column_active_index;xe.confirm({text:"Delete column and all data in it (permanent)",yes_fn:()=>{function n(e){e.querySelectorAll("td")[t].remove()}g0.db.column.delete(t),e.db_thead.querySelectorAll("tr").forEach(n),e.db_tbody.querySelectorAll("tr").forEach(n),Ce('"Deleted Column"'),m(),r()},no_fn:()=>Ce('Cancelled "Delete Column"')})},T.add=t=>{let n="after"===t,o="before"===t,l=null,i=(n?g0.db.column.insert_after:g0.db.column.insert_before)({index:g0.column_active_index,object:{name:"",note:"",type:"any",sift:!1,find:""}}),c=null;function s(e){return t=>{var r;c=e?t.make_new_cell(i):a("td"),l=t.querySelectorAll("td")[g0.column_active_index],o?t.insertBefore(c,l):n&&(r=c,l.insertAdjacentElement("afterend",r))}}e.db_thead.querySelectorAll("tr").forEach(s(!0)),e.db_tbody.querySelectorAll("tr").forEach(s(!1)),r()},s("click",(function(t){if(ae(e.column_actions_po),"BUTTON"!==t.target.tagName)return;let n=T,o={column_add_before:()=>n.add("before"),column_add_after:()=>n.add("after"),column_move_left:()=>n.move({left:!0}),column_move_right:()=>n.move({left:!1}),column_delete:n.delete,column_sort_a_z:()=>n.sort({reverse:!1}),column_sort_z_a:()=>n.sort({reverse:!0}),column_rename:n.rename,column_tweak_note:n.tweak_note,column_tweak_type:n.tweak_type}[t.target.id];o&&(o(),Te(),M())}),e.column_actions_po),w((e=>{e.preventDefault(),"TD"===e.target.tagName&&$(e)}),e.db_thead),s("click",(function(t){if(ae(e.row_actions_po),"BUTTON"!==t.target.tagName)return;let n={record_make_above:()=>C({above:!0}),record_make_below:()=>C({above:!1}),record_delete_all_ticked:ie,record_delete_clicked:re,record_clone:E,record_copy_as_js_ob:A}[t.target.id];n&&(n(),fe())}),e.row_actions_po);const O={};function B(){let t=g0.current_filter_cell;t.column.find=e.filter_query.value.trim(),z(t),r(),m()}function j(){g0.current_filter_cell.classList.remove("selected"),g0.current_filter_cell=null,ae(e.filter_popover),we()}function z(e){let t,n=e.column;t=n.sift&&n.find.length>0?n.find:"",t?e.title=t:e.removeAttribute("title")}function P(t){let n=t.target;g0.current_filter_cell=n,g0.current_filter_cell.classList.add("selected"),ce(e.filter_popover),L({event:t,element:e.filter_popover.querySelector(".faux_po_content")}),e.filter_query.focus(),e.filter_switch.textContent=n.column.sift?"Doze":"Wake",e.filter_query.value=n.column.find}function R(){if(1!==g0.selected_cells?.size)return void Ce('If you select a cell, "F" key opens the column filter');let t=y(g0.selected_cells),n=[...t.parentNode.querySelectorAll("td")].indexOf(t);e.filter_row.querySelectorAll("td")[n].click()}O.name=t=>{let n=a("tr",e.db_thead);e.column_names=n;a("th",n);n.make_new_cell=e=>{let t=a("td",n);return t.dataset.note=e.note,t.column=e,t.textContent=e.name,t.onclick=$,t},t.column.get_all().forEach(n.make_new_cell)},s("input",B,e.filter_query),s("click",(()=>{let t=g0.current_filter_cell,n=!t.column.sift;t.column.sift=n?1:0,e.filter_switch.textContent=n?"Doze":"Wake",B()}),e.filter_switch),s("click",(()=>{j()}),e.filter_popover_hide),O.find=t=>{let n=a("tr",e.db_thead);n.id="filter_row",e.filter_row=n;let o=a("th",n);o.textContent="Find",o.dataset.t="Show rows whose columns contain these values",n.make_new_cell=e=>{let t=a("td",n);return t.column=e,z(t),t.onclick=P,t},t.column.get_all().forEach(n.make_new_cell)};let F={};function W(t){g0.records_matching_current_filters=t;const n=Number(e.page$rows_each.value);g0.page.total=Math.max(1,Math.ceil(t.length/n)),g0.page.current>g0.page.total&&(g0.page.current=g0.page.total),e.page_number.textContent=g0.page.current,e.page_total.textContent=g0.page.total;const o=(g0.page.current-1)*n,l=o+n,r=t.slice(o,l);F.update_button_states(),function(t){const n=document.createDocumentFragment();t.forEach((e=>n.appendChild(e))),e.db_tbody.innerHTML="",e.db_tbody.appendChild(n)}(r.map(S)),we(),fe(),Te()}function H(){var t;e.db_thead.innerHTML="",t=g0.db.meta,e.db_name.meta=t,e.db_name.textContent=e.db_name.meta.name,e.db_name.onclick=()=>{xe.prompt({message:"Rename DB",initial:e.db_name.meta.name,yes_fn:t=>{t=t.trim(),e.db_name.textContent=t,e.db_name.meta.name=t},no_fn:()=>{Ce("Cancelled rename DB")}})},O.name(g0.db),M(),O.find(g0.db)}function J(){H(),m()}function U(e){return Array.isArray(e)}function I(e){return["INPUT","BUTTON","SELECT","TEXTAREA"].includes(e.tagName)}function Y(e){function t(e){I(e)?e.disabled=!0:e.classList.add("disabled")}U(e)?e.forEach(t):t(e)}function K(e){function t(e){I(e)?e.disabled=!1:e.classList.remove("disabled")}U(e)?e.forEach(t):t(e)}function X(){0==e.menu_items_searcher.value.trim().length?(e.menu_items_searcher.blur(),e.main_menu_po.hidePopover()):(e.menu_items_searcher.value="",e.menu_items_searcher.focus(),Z())}function G(){e.main_menu_po.showPopover(),e.menu_items_searcher.focus()}F.update_button_states=()=>{let t=g0.page.current<2;e.page_left.disabled=t;let n=g0.page.current===g0.page.total;e.page_right.disabled=n},F.show_previous=()=>{g0.page.current<2||(g0.page.current--,W(g0.records_matching_current_filters))},s("click",F.show_previous,e.page_left),F.show_next=()=>{g0.current_page===g0.page.total||(g0.page.current++,W(g0.records_matching_current_filters))},s("click",F.show_next,e.page_right),s("input",(()=>{W(g0.records_matching_current_filters)}),e.page$rows_each),s("input",Z,e.menu_items_searcher),s("click",(t=>{e.main_menu_po.hidePopover()}),e.menu_items),s("click",(function(){e.po_license.showPopover()}),e.show_po_license),s("click",G,e.show_main_menu_po),s("focus",(()=>{Z()}),e.menu_items_searcher);let V=[...e.menu_items.getElementsByTagName("DIV")].map((e=>{let t={dom:e,dom_text:e.textContent.toLowerCase().trim()};return t.words=t.dom_text.split(/\s+/),t}));function Z(){let t=e.menu_items_searcher.value.toLowerCase().trim();function n(e){g0.menu_items_matching_search.push(e),ce(e.dom)}if(g0.menu_items_matching_search.length=0,g0.selected_menu_item=null,0==t.length)V.forEach((e=>{!e.dom.classList.contains("disabled")?n(e):ae(e.dom)}));else{let e=t.split(/\s+/);e.length;V.forEach((t=>{let o=!t.dom.classList.contains("disabled"),l=(r=t.words,e.every((e=>r.some((t=>t.startsWith(e))))));var r;o&&l?n(t):ae(t.dom)}))}ee()}function Q(e){e.dom.querySelector("input").checked=!0,g0.selected_menu_item=e}function ee(){let e=g0.menu_items_matching_search.length>0?g0.menu_items_matching_search:V;if(0===e.length)return;let t=e.indexOf(g0.selected_menu_item),n=e.length-1==t?0:t+1;t!==n&&(Q(e[n]),me(g0.selected_menu_item.dom))}function te(){let e=g0.menu_items_matching_search.length>0?g0.menu_items_matching_search:V;if(0===e.length)return;let t=e.indexOf(g0.selected_menu_item),n=t<1?e.length-1:t-1;t!==n&&(Q(e[n]),me(g0.selected_menu_item.dom),me(g0.selected_menu_item.dom))}function ne(e){e.preventDefault(),g0.selected_menu_item&&(e.target.blur(),e.target.value="",g0.selected_menu_item.dom.click())}function oe(){if(1!==g0.selected_cells?.size)return void Ce('If you select a cell, "Enter" key will start edit mode');let t=y(g0.selected_cells),n=t.parentNode,o=[...n.querySelectorAll("td")].indexOf(t),l=n.record;xe.prompt({initial:l[o]??"",yes_fn:n=>{let i=e.column_names.querySelectorAll("td")[o].column;n=n.trim(),t.textContent=n,l[o]=d(i.type,n),m(),r()},no_fn:()=>{Ce("Cancelled editing cell")}})}function le(e){g0.db.record.delete(e.record),e.remove(),g0.trs_selected.delete(e)}function re(){le(g0.row_to_act_on)}function ie(){let e=g0.trs_selected.size;xe.confirm({text:`Delete ${e} ticked rows?`,yes_fn:()=>{g0.trs_selected.forEach(le),m(),r(),Ce(`Deleted ${e} rows`)},no_fn:()=>Ce('Cancelled "delete ticked rows"')})}function ae(e){e.classList.add("hide")}function ce(e){e.classList.remove("hide")}const se=(()=>{const e="handles",t="2025_0506";let n=null;const o={open_db:()=>new Promise(((t,o)=>{const l=indexedDB.open("fileHandleDB",1);l.onupgradeneeded=t=>{const n=t.target.result;n.objectStoreNames.contains(e)||n.createObjectStore(e,{keyPath:"id"})},l.onsuccess=e=>{n=e.target.result,t()},l.onerror=e=>o(e.target.error)}))},l=(t,o)=>new Promise(((l,r)=>{const i=o(n.transaction(e,t).objectStore(e));i.onsuccess=()=>l(i.result),i.onerror=e=>r(e.target.error)}));return o.save_handle=(e,n)=>l("readwrite",(o=>o.put({id:t,handle:e,name:n}))),o.load_handle=()=>l("readonly",(e=>e.get(t))),o.delete_handle=()=>l("readwrite",(e=>e.delete(t))),o})(),de=async(e,t="readwrite")=>{const n={mode:t};return"granted"===await e.queryPermission(n)||"granted"===await e.requestPermission(n)},_e=t=>{e.file_status.textContent=t};s("click",(()=>{e.file_dialog.close()}),e.file_dialog_done_button),window.addEventListener("beforeunload",(e=>{g0.has_unsaved_changes&&e.preventDefault()}));const ue={};ue.update_file_buttons=async()=>{const t=await se.load_handle();[e.file_forget,e.file_save,e.file_close].forEach(t?K:Y),t&&!g0.file_is_loaded?(ce(e.file_load_stored),e.file_load_stored.textContent=`Load "${t.name}"`,e.file_load_stored.focus(),Y(e.file_close)):(ae(e.file_load_stored),K(e.file_close))},ue.load_editor=async(t,n=null)=>{if(await ue.file_close(),f(),_e("Reading file..."),!await de(t,"read"))throw Error("Read permission denied");const o=await t.getFile();let l=o.type.startsWith("application/json"),r=o.type.startsWith("application/gzip")||o.type.startsWith("application/x-gzip");if(!(l||r))return a="Not JSON / Gzipped JSON file",e.file_dialog_message.textContent=a,void e.file_dialog.showModal();var a;let c;if(l&&(c=await o.text()),r){const e=await o.arrayBuffer();c=await async function(e){let t=e;e instanceof ArrayBuffer&&(t=new Blob([e]));const n=t.stream().pipeThrough(new DecompressionStream("gzip")),o=await new Response(n).blob();return await function(e){return new Promise(((t,n)=>{const o=new FileReader;o.onload=()=>t(o.result),o.onerror=n,o.readAsText(e)}))}(o)}(e)}!function(e){if(!e)return console.log("No data stored to restore");h(JSON.parse(e)),J()}(c),i(),g0.file_is_loaded=!0,n&&_e(`Loaded "${n}"`),await ue.update_file_buttons()},ue.save_content=async(e,t)=>{const n=performance.now();if(!await de(e))throw Error("Write permission denied");const o=await e.createWritable();let l=g("");if(t.endsWith(".gz")){const e=new TextEncoder,t=new ReadableStream({start(t){t.enqueue(e.encode(l)),t.close()}}).pipeThrough(new CompressionStream("gzip"));await t.pipeTo(o)}else await o.write(l),await o.close();_e("File saved successfully. "+function(e){return"Took "+function(e){const t=Math.floor(e/1e3),n=Math.floor(t/60),o=t%60;if(0===n)return o+"s";return`${n}m ${o}s`}(performance.now()-e)}(n)),g0.file_is_loaded=!0,i()},ue.file_save=async()=>{const e=await se.load_handle();if(!e)return ue.file_save_as();await de(e.handle)||_e("Permission denied."),await ue.save_content(e.handle,e.name),await ue.update_file_buttons()},ue.file_save_as=async()=>{const e=await window.showSaveFilePicker({suggestedName:u()+".gz",types:[{description:"JSON",accept:{"application/json":[".json"]}},{description:"Gzip Compressed File",accept:{"application/gzip":[".gz"],"application/x-gzip":[".gz"]}}]});if(!await de(e))return _e("Permission denied.");const t=await e.getFile();await se.save_handle(e,t.name),await ue.save_content(e,t.name),await ue.update_file_buttons()},ue.file_select=async()=>{try{const[e]=await window.showOpenFilePicker();_e("Saving file handle...");const t=(await e.getFile()).name;await se.save_handle(e,t),await ue.load_editor(e,t)}catch(e){"AbortError"===e.name?Ce("Cancelled 'open file'"):console.error("An error occurred:",e)}},ue.file_load_stored=async()=>{if(!await ue.file_close())return;const e=await se.load_handle().catch((e=>{console.log(e.message),console.log("Possibilities:\n- Tool hasn't setup the indexedDB (idb) yet\n- idb has no file stored to re-open\n- tool tried to open file before user page interaction")}));e&&(await de(e.handle,"read")||_e("Permission not granted."),await ue.load_editor(e.handle,e.name))},ue.file_close=async()=>!(g0.has_unsaved_changes&&!confirm("You have unsaved changes. Close anyway?"))&&(f(),_e("File closed. Handle remains."),await ue.update_file_buttons(),!0),ue.file_forget=async()=>{!await ue.file_close()||(await se.delete_handle(),_e("Handle Forgotten."),await ue.update_file_buttons())};function fe(){e.record_facts$filter_matches.textContent=g0.records_matching_current_filters.length,e.record_facts$total.textContent=g0.db.record.length}function me(e){const t=e.getBoundingClientRect(),n=e.parentNode,o=n.getBoundingClientRect();let l=t.top<o.top;t.bottom>o.bottom?n.scrollTop+=t.bottom-o.bottom:l&&(n.scrollTop+=t.top-o.top)}function ge(){g0.trs_selected.forEach(pe),g0.trs_selected.clear()}function pe(e){if(!e)return console.log("pass deselect_row a TR");e.classList.remove("selected"),g0.trs_selected.delete(e)}function y(e){return e.values().next().value}let he=()=>!(1!==g0.selected_cells.size)&&y(g0.selected_cells),ye=e=>{let t=he();if(!t)return void we();let n=function(e,t){if(!(e instanceof HTMLTableCellElement))return console.error("Invalid TD element."),!1;const n=e.parentElement;if(!n||"tr"!==n.nodeName.toLowerCase())return!1;const o=Array.from(n.querySelectorAll("td")),l=o.indexOf(e);if("left"===t)return l>0&&o[l-1];if("right"===t)return l<o.length-1&&o[l+1];const r=n.parentElement;if(!r||"tbody"!==r.nodeName.toLowerCase())return!1;const i=Array.from(r.querySelectorAll("tr:not(.hide)")),a=i.indexOf(n),c=e=>{const t=Array.from(e.querySelectorAll("td"));return t.length>l&&t[l]};return"above"===t?a>0&&c(i[a-1]):"below"===t?a<i.length-1&&c(i[a+1]):(console.error("Invalid direction. Use 'left', 'right', 'above', or 'below'."),!1)}(t,e);if(!n)return!1;v(),x(n)};function we(){let t=function(e){if(!e||"tbody"!==e.nodeName.toLowerCase())return console.error("Provided element is not a valid tbody."),!1;const t=e.querySelector("tr:not(.hide)");return t&&t.querySelector("td")||!1}(e.db_tbody);t&&(v(),x(t))}function be({left:e,right:t,above:n,below:o}){let l=he();if(!l)return;let r=q(l);if(e||t)g0.column_active_index=r,T.add(e?"before":"after"),ye(e?"left":"right");else if(n||o){g0.row_to_act_on=l.parentNode;let e=C({above:n});e&&(v(),x(e.querySelectorAll("td")[r]))}}function ve(e){e.preventDefault();let t=e.target;if(0===t.value.length)return Se();t.value="",t.focus()}s("keydown",(function(t){let n;if(document.activeElement==e.menu_items_searcher)n={Escape:X,Enter:ne,ArrowDown:ee,ArrowUp:te}[t.key];else if(document.activeElement===e.prompt_input){n={cmd_Enter:()=>e.prompt_button_yes.click(),Escape:ve}[(t.metaKey?"cmd_":"")+t.key]}else if(null!==g0.current_filter_cell&&void 0!==g0.current_filter_cell)n={Escape:j,Enter:j}[t.key];else{if(null!==document.querySelector("dialog[open]")||null!==document.querySelector(":popover-open"))return;n={"/":G,f:R,Enter:oe,alt_ArrowUp:()=>be({above:1}),alt_ArrowDown:()=>be({below:1}),alt_ArrowLeft:()=>{be({left:1}),Te()},alt_ArrowRight:()=>{be({right:1}),Te()},ArrowUp:()=>ye("above"),ArrowDown:()=>ye("below"),ArrowLeft:()=>ye("left"),ArrowRight:()=>ye("right")}[(t.altKey?"alt_":"")+t.key]}n&&(t.preventDefault(),n(t))}),window),s("click",(()=>{let t=u(),n=e.prompt_input,o=n.value.trim();0!=o.length?n.value=o+" "+t:n.value=t}),e.insert_date);const xe={};function Se(){g0.prompt_pending=!1,ae(e.prompt_po),g0.prompt_no_fn&&(g0.prompt_no_fn(),g0.prompt_no_fn=null),e.prompt_input.value=""}xe.prompt=({message:t,initial:n,yes_fn:o=null,no_fn:l=null,y_text:r="Apply",n_text:i="Exit"})=>{g0.prompt_pending=!0,t?(e.prompt_message.textContent=t,ce(e.prompt_message)):ae(e.prompt_message),g0.prompt_yes_fn=o,g0.prompt_no_fn=l,e.prompt_input.value=n,ce(e.prompt_po),e.prompt_input.focus(),e.prompt_button_no.textContent=i,e.prompt_button_yes.textContent=r},s("click",Se,e.prompt_button_no),s("click",(function(){g0.prompt_pending=!1,ae(e.prompt_po),g0.prompt_yes_fn&&(g0.prompt_yes_fn(e.prompt_input.value),g0.prompt_yes_fn=null),e.prompt_input.value=""}),e.prompt_button_yes),s("click",(()=>{g0.prompt_pending&&Se()}),e.prompt_po_hide),xe.confirm=({text:t="",yes:n="Yes",no:o="No",yes_fn:l,no_fn:r})=>{l||console.warn("Pass confirm a yes_fn"),g0.confirm_yes_fn=l,g0.confirm_no_fn=r,e.confirm_message.textContent=t,e.confirm_button_yes.textContent=n,e.confirm_button_no.textContent=o,e.confirm_dialog.showModal(),e.confirm_button_yes.focus()},s("click",(()=>{e.confirm_dialog.close(),g0.confirm_yes_fn&&(g0.confirm_yes_fn(),g0.confirm_yes_fn=null)}),e.confirm_button_yes),s("click",(()=>{e.confirm_dialog.close(),g0.confirm_no_fn&&(g0.confirm_no_fn(),g0.confirm_no_fn=null)}),e.confirm_button_no);let ke=null;function Ce(t){e.notice.textContent=t,ce(e.notice),ke=setTimeout((()=>ae(e.notice)),3e3)}s("load",(async function(){"showOpenFilePicker"in window&&"showSaveFilePicker"in window?(await(async()=>{await se.open_db(),await ue.update_file_buttons();const t=await se.load_handle();_e(t?`Stored file reference found: "${t.name}"`:"No stored file reference. Open or Save As to begin."),["file_select","file_load_stored","file_close","file_forget","file_save","file_save_as"].forEach((t=>{e[t].onclick=ue[t]}))})(),await ue.update_file_buttons(),g0.file_is_loaded||(h({meta:{name:"Demo",made:u(),note:"An example table showing some shortcuts"},form:l([{name:"Press",note:"Keyboard shortcut",type:"string",find:"",sift:1},{name:"Action",note:"What the shortcut does",type:"string",find:"",sift:1},{name:"Tag",note:"Relates to",type:"string",find:"",sift:1,seed:"Default_Value_Demo"}]),list:[["alt+up","Add row above current selected cell","Row"],["alt+down","Add row below current selected cell","Row"],["alt+left","Add column to left of current selected cell","Column"],["alt+right","Add column to right of current selected cell","Right"],["f","Filter current cell column (`/regex/i`)","Column"],["/","Open menu and search for option","Tool"],["Enter","Edit","Cell"],["Enter","Insert\nNewline","Editor"],["CMD+Enter","Apply Edit","Cell"],["Arrow up","Select cell above","Cell"],["Arrow down","Select cell below","Cell"],["Arrow left","Select cell on the left","Cell"],["Arrow right","Select cell on the right","Cell"],["Hover","Show any tip","Tool"]]}),J()),function(){function e(){g0.allow_auto_save&&(g0.allow_auto_save=!1,g0.file_is_loaded&&g0.page_loaded&&g0.has_unsaved_changes&&(console.log("try save"),ue.file_save()))}s("blur",e,window),s("beforeunload",e,window),s("pagehide",e,window),s("visibilitychange",e,document),g0.page_loaded=!0}(),Te()):ce(e.unsupported_browser)}),window);let Ae=function(e){const t=document.createElement("span");e&&(t.style.fontSize=e);t.style.position="fixed",t.style.visibility="hidden",t.style.whiteSpace="nowrap",t.textContent="0",document.body.appendChild(t);const n=t.offsetWidth;return document.body.removeChild(t),n}(),Ee=15;function Te(){!function(e){e.style.width="auto";const t=e.getBoundingClientRect().width,n=e.parentNode.clientWidth,o=Ae;let l=Math.round(t/o)*o;l>n&&(l=Math.floor(n/o)*o),l!==t&&(e.style.width=l+"px")}(e.db_table)}!function(e,t,n){let o;const l=()=>{const o=Math.round(e.scrollTop/t)*t,l=Math.round(e.scrollLeft/n)*n;e.scrollTo({top:o,left:l,behavior:"smooth"})};e.addEventListener("scroll",(()=>{clearTimeout(o),o=setTimeout((()=>{l()}),100)})),e.addEventListener("wheel",(t=>{t.preventDefault();const n=t.deltaY,r=t.deltaX;e.scrollTop+=n,e.scrollLeft+=r,clearTimeout(o),o=setTimeout((()=>{l()}),100)}))}(e.table_holder,Ee,Ae),s("click",(()=>{e.table_holder.scrollTop=0}),e.scroll_to_top),s("scroll",(()=>{e.table_holder.scrollTop>0&&e.scroll_to_top.classList.contains("hide")&&ce(e.scroll_to_top),0!=e.table_holder.scrollTop||e.scroll_to_top.classList.contains("hide")||ae(e.scroll_to_top)}),e.table_holder),window.addEventListener("resize",Te)})();</script></body></html>