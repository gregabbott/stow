<!-- Merged 2025_10_01 -->
<html lang="en"><head><meta charset="UTF-8"><meta name="color-scheme" content="light dark"><link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbDpzcGFjZT0icHJlc2VydmUiICB4PSIwIiB5PSIwIiB2ZXJzaW9uPSIxLjEiIHZpZXdCb3g9IjAgMCAyMDAgMjAwIj4KICA8c3R5bGU+LmF7CmZpbGw6IzI1MjUyNTsKZm9udC1mYW1pbHk6VmVyZGFuYTsKdGV4dC1hbmNob3I6bWlkZGxlOwp9PC9zdHlsZT4KICA8cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgZmlsbD0iI0ZGRiIvPjx0ZXh0IGNsYXNzPSJhIiBmb250LXNpemU9IjY4cHgiIHg9IjEwMCIgeT0iMTE2Ljg3NSI+U3RvdzwvdGV4dD48L3N2Zz4="><style>/* c.css */
:root {color-scheme: light dark;--light: hsl(0, 0%, 100%);--dark: hsl(0, 0%, 0%);--accent: #8e70f7;--rad: 1lh;}* {margin: 0;padding: 0;font-family: DejaVu Sans Mono, Hack, Menlo, CommitMono,JetBrains Mono,monospace;font-size-adjust: ex-height 0.53;box-sizing: border-box;font-size: 15px;user-select: none;line-height: 100%;outline: none;border: none;}.themeable{--bg: light-dark(var(--light), var(--dark));--fg: light-dark(var(--dark), var(--light));--bs0: inset 0 0 0 .5px var(--fg);--bs: inset 0 0 0 1px var(--fg);--bs2: inset 0 0 0 2px var(--fg);--brd: 1px solid var(--fg);accent-color: var(--fg);* {color: var(--fg);}}a{color: var(--fg);}hr{height: 1lh;}table{border-collapse: collapse;}.select_holder {width: 6ch;height: 2lh;box-shadow: inset 0 0 0 1px var(--fg);background-color: var(--bg);color: var(--fg);display: block;}select {background-color: transparent;border: none;padding: 0;font-size: 15px;position: relative;width: 100%;height: 100%;padding: 0 1ch;-webkit-appearance: none;-moz-appearance: none;appearance: none;}#page_numbers{line-height: 2lh;}#po_recent_files_holder {button:focus, .button:focus {outline: 2px solid var(--fg);outline-offset: 2px;}}.faux_po_holder{width: fit-content;height: fit-content;display: block;position: absolute;z-index: 4;}.faux_po_content {box-shadow: 3px 3px 0 0 var(--fg);outline: var(--brd);outline-offset: -1px;background: var(--bg);overflow: hidden;position: fixed;display: flex;flex-direction: column;}#row_actions_po,#column_actions_po{.faux_po_content{margin: -.5px !important;padding: 0;width: 16ch;max-height: calc(100dvh - 2lh);overflow-y: auto;button {box-shadow: none;width: 100%;text-align: left;&:hover {background: var(--fg);color: var(--bg);}}}}#column_type_po .faux_po_content{width: 64ch;padding: 1lh 1ch;select {width: 100%;}}#filter_popover .faux_po_content{top: 1lh;left: 1ch;display: flex;flex-direction: row;#filter_switch{padding: .5em 1ch;width: 6ch;text-align: right;}gap: 0ch;align-items: center;#filter_query{width:40ch}#filter_name{width: 40ch;}}.faux_po_backdrop {position: fixed;top: 0;left: 0;background: var(--accent);opacity: 0.0;height: 100dvh;width: 100dvw;display: block;}.full_viewport_notice {position: fixed;background-color: var(--bg);color: var(--fg);padding: 2ch;top: 0;left: 0;height: 100dvh;width: 100dvw;z-index: 999;display: flex;flex-direction: column;align-items: center;justify-content: center;text-align: center;}:popover-open,dialog:open {display: flex;flex-direction: column;}[popover],dialog {box-shadow: 3px 3px 0 0 var(--fg);outline: 1px solid var(--fg);outline-offset: 0px;border: none;left: 3ch;top: 2lh;padding: 2lh 3ch;max-height: calc(100dvh - 4lh);background-color: var(--bg);z-index: 9999;width: 64ch;max-width: calc(100dvw - 2ch);}button,input {margin: 0;border: none;}input {padding: 0 1ch;background-color: transparent;height: 2lh;&[type="search"] {box-shadow: var(--bs);}outline: 0;}button,.button {padding: 0 1ch;display: flex;align-items: center;box-shadow: inset 0 0 0 1px var(--fg);height: 2lh;background-color: var(--bg);color: var(--fg);border: none;&:active {box-shadow:inset 0 0 0 1px var(--fg);;xbackground: var(--fg);xcolor: var(--bg);}}html,body {height: 100dvh;max-height: 100dvh;margin: 0;overflow: hidden;}.themeable {color: var(--fg);background-color: var(--bg);display: flex;flex-direction: column;padding: 0lh 0 0 0;min-height: 100dvh;max-height: 100dvh;height: 100dvh;}main {display: flex;flex-grow: 1;overflow: hidden;}#menu_items {display: flex;flex-direction: column;}.new_column_strip {position: absolute;display: block;height: 100dvh;right: -1px;z-index: 999;width: 2px;background-color: var(--fg);cursor: pointer;}#show_grid:checked ~ * label[for="show_grid"]{box-shadow: var(--bs2);}#dragover_notice {position: fixed;top: 0;left: 0;width: 100dvw;height: 100dvh;border: 1ch dashed var(--fg);pointer-events: none;}body:has(#show_grid:checked) .themeable{--col:hsla(0, 0%, 50%, 0.2);background-image:linear-gradient(to right,var(--col) 1px,transparent 1px),linear-gradient(to bottom,var(--col) 1px,transparent 1px);background-size: 1ch 1lh;background-position: -.5px -.5px;}nav {display: flex;min-height: 2lh;padding: 0 1ch;gap: 1ch;margin-bottom: 1lh;.grow {flex-grow: 1;}}g-db {height: 100%;width: 100%;display: flex;flex-direction: column;#table_holder {display: flex;align-items: start;flex-direction: column;flex: 0 1 auto;overflow-x: scroll;overflow-y: scroll;position: relative;width: 100%;height: 100%;background-color: transparent;max-width: 100%;padding: 0 1ch 50dvh;table {box-sizing: border-box;margin: 0;padding: 0;flex-grow: 0;width: auto;max-width: calc(100dvw - 2ch);height: auto;display: table;table-layout: auto;border-collapse: collapse;border-spacing: 0;border: none;position: relative;&::after{content: "";position: absolute;top: .5px;left: 0px;outline-offset: -.5px;display: block;width: calc(100%);height: calc(100% - .5px);z-index: 3;outline: 1px solid var(--fg);pointer-events: none;}caption {background: var(--bg);outline: 1px solid var(--fg);outline-offset: -.5px;padding: .5em 1ch;}caption,thead{top: 0;position: sticky;z-index: 3;}th {width: 6ch;min-width: 6ch;max-width: 6ch;text-align: right;font-weight: normal;}th,td {background-color: var(--bg);outline: 1px solid var(--fg);outline-offset: -.5px;height: 2lh;white-space: pre-wrap;vertical-align: top;padding:calc(.5em)calc(1ch);line-height:1em;position: relative;min-width: calc(3ch - 1px);hyphens: auto;max-width: 66ch;}td{&:hover, &.selected {z-index: 1;outline-style: solid;outline-width: 1.5px;}}thead {top:2lh;&::after{width: 100%;height: 1px;position: absolute;z-index: 1;bottom: -0.5px;content: "";left: 0;display: block;background-color: var(--fg);}th,td{background-color: var(--bg);}tr:first-of-type td {cursor: context-menu;}}tbody {background-color: var(--accent);counter-reset: row;input[type="checkbox"] {max-height: 1ch;max-width: 1ch;border: none;}tr {counter-increment: row;th:first-of-type {text-align: right;&::after {box-sizing: border-box;content: counter(row);}}&.selected>th:first-of-type::after {content: counter(row);width: calc(100%);height: 100%;padding: .5em 1ch;border-left: 1ch solid var(--fg);position: absolute;left: 0;top: 0;}th:first-of-type {cursor: context-menu;}}}}}}[data-tip]::before{pointer-events: none;position: fixed;top: 0px;font-weight: normal;left: 0px;padding: 0 1ch;display: flex;width: 100dvw;height: 2lh;background: var(--bg);color: var(--fg);text-align: center;text-transform:none;align-items: center;justify-content: center;z-index: 9999;box-shadow: 0px -1px 0px 0px var(--fg) inset;}#notice_area{width: 100%;box-shadow: 0px -1px 0px 0px var(--fg) inset;color: var(--bg);display: flex;min-height: 2lh;margin-bottom: 1lh;}#notice{background-color: var(--fg);color: var(--bg);position: fixed;width: 100%;top: 0px;left: 0px;padding: .5em 1ch;text-align: center;display: block;z-index: 9999;}[data-tip]:hover::before{content: attr(data-tip);}#filter_row td[data-tip]{background-color: var(--fg);color: var(--bg);}#filter_row td[data-tip]::after{position: absolute;content: attr(data-tip);white-space: nowrap;max-width: calc(100% - 2ch);left: 1ch;overflow: hidden;text-overflow: ellipsis;}.x,.y {display: flex;gap: 1ch;}x{align-content: center;}.y{flex-direction: column;}#show_compact:checked ~ * {label[for="show_compact"]{box-shadow: var(--bs2);}thead {top:1lh;}caption {padding: 0em 1ch;}#db_table tr {th, td {padding: 0em 1ch;height: 1lh;}&.selected>th:first-of-type::after {padding-top: 0;}}}body:has(:popover-open) {#hide_popover {display: block;}}::backdrop {opacity: 0;}#hide_popover{z-index: 99;display: none;background: var(--dark);opacity: 0;width: 100dvw;content: "";height: 100dvh;position: fixed;top: 0;left: 0;}.hide {display: none !important;}#prompt_po {padding: 0;left: 1ch;p{padding: .5em 1ch;border-bottom: 1px dashed var(--fg);}textarea {box-shadow: none;border-bottom: var(--brd);width: 100%;font-size: 1lh;height: 4lh;padding: .5lh 1ch;line-height: 100%;margin: 0;resize: none;background-color: var(--bg);}.x {gap: 0;button {width: 16ch;outline: var(--brd);box-shadow: none;&:hover{font-weight: bold;}text-align: center;}padding: 0lh 0ch;}}#main_menu_po {padding: 0;overflow: hidden;#menu_items_searcher {width: 100%;display: block;padding: 1ch;box-shadow: none;border-bottom: var(--brd);}footer {border-top: var(--brd);min-height: 2lh;display: flex;align-items: center;padding: 0 1ch;text-align: center;}#menu_items {max-height: 50dvh;overflow-y: auto;&::-webkit-scrollbar {width: 2ch;height: 1ch;cursor: pointer;}&::-webkit-scrollbar-thumb {background: var(--bg);border-radius: 0;box-shadow: inset 0 0 0 1px var(--fg);border: none;border-right: 1ch solid var(--bg);}gap: 0;div {display: flex;align-items: center;min-height: 2lh;padding: 0 1ch;border: 1px dotted transparent;border-left: none;border-right: none;&:hover {border-color: var(--fg);}input {display: none;padding: 0;margin: 0;}&:has(input:checked) {font-weight: bold;}button {all: unset;cursor: default;padding: 0;height: auto;border: none;&:hover,&:focus {box-shadow: none;outline-color: transparent;}&:active {background-color: var(--bg);color: var(--fg);}}}}}#file_load_stored {&:focus,&:hover {outline: none;background: var(--fg);color: var(--bg);}}.crossed,:disabled,.disabled{position: relative;overflow: hidden;color: transparent;&:before,&:after{content: '';position: absolute;top: 50%;left: 50%;width: 150%;height: 1px;background-color: var(--fg);transform: translate(-50%,-50%) rotate(45deg);}&:after{transform: translate(-50%,-50%) rotate(-45deg);}}:disabled,.disabled {cursor:not-allowed;pointer-events: none;}.active_col{font-weight: bold;}</style><meta name="copyright" content="STOW Project: © 2025 Greg Abbott. All rights reserved."><style id="column_styles"></style><!-- STOW. By + copyright 2025 Greg Abbott--><title>Stow</title></head><body><div class="themeable"><input type="checkbox" id="show_compact" hidden=""><input type="checkbox" id="show_grid" hidden=""><div id="dragover_notice" class="hide"></div><div id="notice_area">&nbsp;</div><div id="notice" class="hide">Stow</div><div popover="" id="po_recent_files_holder"><table><thead><tr><th>Name</th><th>Ext</th><th>Open</th><th>Forget</th></tr></thead><tbody id="recent_files"></tbody></table></div><div popover="" id="po_license"><p>Name: <span data-tip="To carefully and neatly arrange and pack items in a compact mass, and store them in their proper place">Stow</span><br>
Version: 2025_1001<br>
View: <a href="log.html">Change Log</a><br>
By: <a href="https://gregabbott.pages.dev/">Greg Abbott</a></p><hr><p>LICENSE<br>
© 2025 Greg Abbott. All rights reserved.</p><p>NO WARRANTY<br>
THE SOFTWARE IS PROVIDED "AS IS",
WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE
AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE
FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</p></div><noscript><div class="full_viewport_notice"><p>This tool requires JavaScript<br><a href="https://gregabbott.pages.dev/">View other tools</a></p></div></noscript><div id="unsupported_browser" class="full_viewport_notice hide"><div><p>Your browser doesn't support the File Access API.<br>
This tool uses it to edit local files.</p><p><a href="https://gregabbott.pages.dev/">View other tools</a></p></div></div><div id="main_menu_po" popover=""><input type="search" id="menu_items_searcher"><div id="menu_items"><div id="new_db"><input type="radio" name="mi"><button>New DB</button></div><div id="file_select" data-tip="Or drag and drop a file anywhere on this window"><input type="radio" name="mi"><button>Open a file</button></div><div id="see_recent_files"><input type="radio" name="mi"><button>See recent files</button></div><div id="file_close"><input type="radio" name="mi"><button>Close current file</button></div><div id="file_save"><input type="radio" name="mi"><button>Save current file</button></div><div id="file_save_as"><input type="radio" name="mi"><button>Save As File</button></div><div id="show_po_license"><input type="radio" name="mi"><button>Read App License</button></div><div id="copy_db_as_json"><input type="radio" name="mi"><button>Copy DB as JSON</button></div><div id="toggle_compact_mode" data-tip="Toggle the table's vertical cell padding"><input type="radio" name="mi"><button>Toggle compact view</button></div><div id="toggle_ruled_grid"><input type="radio" name="mi"><button>Toggle ruled grid visibility</button></div><div id="scroll_to_top"><input type="radio" name="mi"><button>Scroll to top of table body</button></div></div><footer><div id="file_status"></div></footer></div><div id="filter_popover" class="faux_po_holder hide"><div id="filter_popover_hide" class="faux_po_backdrop"></div><div class="faux_po_content" data-tip="Optionally use JS `/RegularExpressions/gi` to search (e.g. `/[a-z]\d{4}$/i`)"><datalist id="filter_tokens"><option value="&quot;Is Blank&quot;"></option><option value="&quot;Not Blank&quot;"></option></datalist><div id="filter_switch" data-tip="Click to toggle this filter on or off">Flip</div><input id="filter_query" list="filter_tokens" type="search"></div></div><div id="column_type_po" class="faux_po_holder hide"><div id="column_type_po_hide" class="faux_po_backdrop"></div><div class="faux_po_content"><p>Tweak <span id="column_type_current_column_name"></span> column data type</p><select id="column_type_picker"><option data-tip="Convert new input to the most likely type (Number, Boolean, Null, String)">any</option><option data-tip="Keep new inputs as strings">string</option><option data-tip="Convert new input to a number where possible (e.g. &quot;8&quot; -&gt; 8)">number</option><option data-tip="Accept [true, false, null]">boolean</option></select></div></div><dialog id="file_dialog"><p id="file_dialog_message"></p><menu><button id="file_dialog_done_button">done</button></menu></dialog><div id="row_actions_po" class="faux_po_holder hide"><div id="row_actions_po_hide" class="faux_po_backdrop"></div><div class="faux_po_content"><div><button id="record_make_above">Make Above</button></div><div><button id="record_make_below">Make Below</button></div><div><button id="record_delete_all_ticked">Zap ticked rows</button></div><div><button id="record_delete_clicked">Zap row</button></div><div><button id="record_clone">Clone</button></div><div data-tip="Copy row as JSON"><button id="record_copy_as_js_ob">Copy JSON</button></div></div></div><div id="column_actions_po" class="faux_po_holder hide"><div id="column_actions_po_hide" class="faux_po_backdrop"></div><div class="faux_po_content"><div><button id="column_rename" data-tip="Rename this column">Name</button></div><div><button id="column_tweak_note">Note</button></div><div><button id="column_tweak_type">Type</button></div><div><button id="column_delete">Zap</button></div><div><button id="column_sort_a_z">Sort A-Z</button></div><div><button id="column_sort_z_a">Sort Z-A</button></div><div><button id="column_move_left">Move Left</button></div><div><button id="column_move_right">Move Right</button></div><div><button id="column_add_before">Add Left</button></div><div><button id="column_add_after">Add Right</button></div></div></div><div id="prompt_po" class="faux_po_holder hide"><div id="prompt_po_hide" class="faux_po_backdrop"></div><div class="faux_po_content"><p id="prompt_message"></p><textarea id="prompt_input"></textarea><div class="x"><button id="insert_date" data-tip="Insert current date time stamp yyyy_MMdd_hhmm">Stamp</button><button id="prompt_button_yes" data-tip="Apply">Keep</button><button id="prompt_button_no" data-tip="Cancel">Shut</button></div></div></div><mark></mark><nav><button id="show_main_menu_po" data-tip="'/' key also opens menu">Menu</button><div class="pagination_items x"><div class="select_holder" data-tip="Rows Per Page"><select id="page$rows_each"><option>5</option><option>10</option><option selected="">50</option><option>100</option><option>500</option><option>1000</option></select></div><button id="page_left">&lt;</button><span id="page_numbers"><span id="page_number">1</span>/<span id="page_total">1</span></span><button id="page_right">&gt;</button></div><div id="facts"><span data-tip="Current Saved Status" id="current_saved_status">Unsaved</span> | <span data-tip="Records shown that match active filters">Hits <span id="record_facts$filter_matches">N</span></span> | <span data-tip="Records / rows in database">Rows <span id="record_facts$total">N</span></span></div></nav><main><g-db><div id="table_holder"><table id="db_table"><caption id="db_name"></caption><thead id="db_thead"></thead><tbody id="db_tbody"></tbody></table></div></g-db></main><dialog id="confirm_dialog"><p id="confirm_message"></p><div id="confirm_buttons" class="x"><button id="confirm_button_no">No</button><button id="confirm_button_yes" autofocus="">Yes</button></div></dialog><div id="hide_popover"></div></div><script>/* make_table.js */
function make_table({meta:e,columns:t,records:n,on_insert_row:l,on_delete_row:r}){let o=t.map((e=>({...e}))),c=[],i=new Map,s=!1,a=new Map;function _(){s&&(a.clear(),c.forEach(((e,t)=>{a.set(e,t)})))}function d(){c.length>=1e3&&!s?(s=!0,_()):c.length<1e3&&s&&(s=!1,a.clear())}function u(e){let t=function(e){let t=[...e];return o.forEach(((e,n)=>{void 0===t[n]&&Object.prototype.hasOwnProperty.call(e,"seed")&&(t[n]=e.seed)})),t}(e);return t.id=Symbol(),t}function f(e,t){let n=u(t);return c.splice(e,0,n.id),i.set(n.id,n),d(),_(),l&&l(n),n}function g(e){return s?a.get(e.id):c.indexOf(e.id)}function p(e,t){let[n]=c.splice(e,1);c.splice(t,0,n),_()}const h={add:e=>f(c.length,e),insert_a_before_b:(e,t)=>f(g(t),e),insert_a_after_b:(e,t)=>f(g(t)+1,e),move_up(e){let t=g(e);t>0&&p(t,t-1)},move_down(e){let t=g(e);t>=0&&t<c.length-1&&p(t,t+1)},move_before(e,t){let n=g(e),l=g(t);n>=0&&l>=0&&n!==l-1&&p(n,l)},move_after(e,t){let n=g(e),l=g(t);n>=0&&l>=0&&n!==l+1&&p(n,l+1)},delete(e){let t=g(e);t>=0&&(c.splice(t,1),i.delete(e.id),d(),_(),r&&r(e))},get_all:()=>c.map((e=>i.get(e))),filter(e){const t=[];for(const n of c){const l=i.get(n);e(l)&&t.push(l)}return t},get_index:e=>g(e),get_by_index(e){let t=c[e];return i.get(t)},get size(){return c.length},get length(){return c.length}};function b(e,t){let[n]=o.splice(e,1);o.splice(t,0,n),h.get_all().forEach((n=>{let[l]=n.splice(e,1);n.splice(t,0,l)}))}const m={add(e){let t={...e};o.push(t);let n=t&&Object.prototype.hasOwnProperty.call(e,"seed")?e.seed:null;return h.get_all().forEach((e=>{e.push(n)})),t},insert_before({index:t,object:n}){let l={...n};o.splice(t,0,l);let r=l&&Object.prototype.hasOwnProperty.call(l,"seed")?e.seed:null;return h.get_all().forEach((e=>{e.splice(t,0,r)})),l},insert_after:({index:e,object:t})=>m.insert_before({index:e+1,object:t}),move_a_before_b(e,t){b(e,t)},move_a_after_b(e,t){b(e,t+1)},move_left(e){e<=0||b(e,e-1)},move_right(e){e>=o.length-1||b(e,e+1)},delete(e){o.splice(e,1),h.get_all().forEach((t=>t.splice(e,1)))},get_all:()=>o,get_index:e=>o.indexOf(e),get_by_index:e=>o[e],get size(){return o.length}};return n.forEach(h.add),{meta:e,column:m,record:h,sort_records:function({column_index:e,reverse:t=!1}){c.sort(((n,l)=>{let r=i.get(n)[e],o=i.get(l)[e];return r<o?t?1:-1:r>o?t?-1:1:0})),_()},display_table:function(){console.log({columns:o,rows:h.get_all()})},_useMapping:()=>s,_rowIdToIndex:()=>a}}
/* j.js */
const g0={},el=[...document.querySelectorAll('[id]:not([id=""])')].reduce(((e,t)=>(e[t.id.trim()]=t,e)),{});function off(e,t,n){return n?(n.removeEventListener(e,t),n):n=>off(e,t,n)}function on(e,t,n){return n?(n.addEventListener(e,t),n):n=>on(e,t,n)}function hide(e){e.classList.add("hide")}function show(e){e.classList.remove("hide")}function element_supports_disabled_attribute(e){return["INPUT","BUTTON","SELECT","TEXTAREA"].includes(e.tagName)}function disable(e){function t(e){element_supports_disabled_attribute(e)?e.disabled=!0:e.classList.add("disabled")}is_array(e)?e.forEach(t):t(e)}function enable(e){function t(e){element_supports_disabled_attribute(e)?e.disabled=!1:e.classList.remove("disabled")}is_array(e)?e.forEach(t):t(e)}function is_array(e){return Array.isArray(e)}function is_object(e){return e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof Date)}function reset_g0(){g0.db={},g0.file_is_loaded=!1,g0.has_unsaved_changes=!1,g0.last_saved_content="",g0.page={total:1,current:1},g0.record_els_matching_search_filters=[],g0.menu_items_matching_search=[],g0.selected_menu_item=null,g0.column_active_index=null,g0.row_to_act_on=null,el.filter_row=null,g0.trs_selected=new Set,g0.selected_cells=new Set,g0.confirm_yes_fn=null,g0.confirm_no_fn=null,g0.prompt_yes_fn=null,g0.prompt_no_fn=null,g0.prompt_pending=!1}function create_empty_array(e){return Array.from({length:e},(()=>""))}function copy({clicked:e,str:t,pass_fn:n,fail_fn:o}){navigator.clipboard.writeText(t).then((()=>{n&&n()})).catch((e=>{o&&o()}))}function list_of_obs__to__ob_of_lists(e){let t=new Set;e.forEach((e=>{Object.keys(e).forEach((e=>t.add(e)))}));let n={};return t.forEach((t=>{let o=[];e.forEach((e=>{o.push(void 0!==e[t]?e[t]:null)})),n[t]=o})),n}function ob_of_lists__to__list_of_obs(e){const t=Object.keys(e),n=Math.max(...Object.values(e).map((e=>e.length)));return Array.from({length:n},((n,o)=>t.reduce(((t,n)=>(t[n]=e[n][o]||null,t)),{})))}function column_type_fix(e){let t="boolean",n="number",o="any",l="string",r=typeof e===l,_=(e,t)=>typeof e===l&&typeof t===l&&(0!==e.length&&0!==t.length&&e.startsWith(t));return r&&(e=e.toLowerCase()),"*"===e||"a"===e||e===o||null===e?o:typeof e===t||"?"===e||"true"===e||"false"===e||_(t,e)?t:typeof e===n||_(n,e)?n:r?l:o}function new_el(e,t){let n=document.createElement(e);return t?t.appendChild(n):n}reset_g0();let string_to_any_json_primitive=e=>{try{let t=JSON.parse(e);return null===t||!0===t||!1===t||"number"==typeof t?t:e}catch(t){return e}};function convert_to_correct_data_type(e="any",t){if("string"===e)return t;let n=string_to_any_json_primitive(t);return"any"===e?n:0===t.trim().length||null===n?null:typeof n!==e?(notify(`Input "${t}" won't convert to column type '${e}'.`),t):n}function get_date_parts(e=new Date){const t=["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds"],n=["Y","M","d","h","m","s","u"].reduce(((n,o,l)=>{return n[o]=(e[r="get"+t[l]]()+("getMonth"===r)+"").padStart("getMilliseconds"===r?3:2,"0"),n;var r}),{});return n.c=n.Y.substring(0,2),n.y=n.Y.substring(2),n}function get_stamp(e=new Date){let t=get_date_parts(e);return"Y_Md_hm".split("").map((e=>t[e]||e)).join("")}function reset_app(){reset_g0(),el.db_name.innerHTML="",el.db_thead.innerHTML="",el.db_tbody.innerHTML=""}function to_regex_else_false(e){if(!function(e){return e.length>1&&e.startsWith("/")&&/\/(gi|i|g|ig)?$/.test(e)}(e))return!1;let{exp:t,flags:n=""}=e.match(/\/(?<exp>.*)\/(?<flags>gi|i|g|ig)?$/)?.groups;try{return RegExp(t,n)}catch(e){return!1}}function filter_rows(){let e={},t={};g0.record_els_matching_search_filters.length=0;let n=[...el.filter_row.querySelectorAll("td")].reduce(((n,o,l)=>{let r=o.column;if(!r.sift||null==r.find||0===r.find.length)return n;if('"Is Blank"'===r.find)return n.set(l,e),n;if('"Not Blank"'===r.find)return n.set(l,t),n;let _=to_regex_else_false(r.find);if(!1!==_)return n.set(l,_),n;let c=r.find.toLowerCase();return n.set(l,c.split(" ")),n}),new Map);if(0===n.size)return void make_or_remake_DOM_record_rows(g0.db.record.get_all());let o=[...n];make_or_remake_DOM_record_rows(g0.db.record.filter((n=>{let l=!0,r=null,_=null;for(const[c,i]of o)if(r=n[c],_=r+"",i instanceof RegExp){if(!i.test(_)){l=!1;break}}else if(i===e){if(null!==r&&_.trim().length>0){l=!1;break}}else if(i===t){if(null===r||0===_.trim().length){l=!1;break}}else if(1===i.length){if(0==_.toLowerCase().includes(i[0])){l=!1;break}}else{let e=_.toLowerCase().split(" ");if(!1===i.every((t=>e.some((e=>e.startsWith(t)))))){l=!1;break}}return l})))}function live_db_to_JSON(e=""){return g0.db.meta.last=get_stamp(),custom_stringify({meta:g0.db.meta,form:list_of_obs__to__ob_of_lists(g0.db.column.get_all()),list:g0.db.record.get_all()},e)}function custom_stringify(e,t="\t"){if(!is_object(e))throw Error("give custom_stringify an object literal");const n=new Set;function o(e,l=1){if(null==e)return JSON.stringify(e);if("function"!=typeof e&&"symbol"!=typeof e&&void 0!==e){if(Array.isArray(e)){if(e.some((e=>e&&"object"==typeof e))){const n=t.repeat(l);return`[\n${e.map((e=>t.repeat(l+1)+(o(e,l+1)??"null"))).join(",\n")}\n${n}]`}return`[${e.map((e=>o(e,l)??"null")).join(",")}]`}if("object"==typeof e){if(n.has(e))throw new TypeError("Converting circular structure to JSON");n.add(e);const r=t.repeat(l),_=t.repeat(l+1),c=Object.entries(e).map((([e,t])=>{const n=o(t,l+1);return void 0===n?void 0:`${_}"${e}": ${n}`})).filter(Boolean);return n.delete(e),`{\n${c.join(",\n")}\n${r}}`}return JSON.stringify(e)}}return`{\n${Object.entries(e).map((([e,n])=>{const l=o(n,1);return void 0===l?void 0:`${t}"${e}": ${l}`})).filter(Boolean).join(",\n")}\n}`}function copy_db_as_json(){copy({str:live_db_to_JSON(""),pass_fn:()=>notify("Copied DB as JSON"),fail_fn:()=>notify("Failed to copy DB as JSON")})}function toggle_checkbox(e){e.checked=!e.checked}async function make_new_db(){let e=!0;if(g0.file_is_loaded){if(!await f_action.file_close())return;e=!1}ui.prompt({message:"Wanted column names (Comma Separate)",initial:"A,B,C",yes_fn:t=>{e&&reset_app();let n=t.split(",");revive_db({meta:{name:"Untitled Doc",made:get_stamp(),note:""},form:{name:n},list:[create_empty_array(n.length)]}),load_db_to_frontend(),mark_need_to_save()},no_fn:()=>{notify('Cancelled "Make New DB"')},y_text:"Make",n_text:"Stop"})}function load_example_db(){revive_db({meta:{name:"Demo",made:get_stamp(),note:"An example table showing some shortcuts"},form:list_of_obs__to__ob_of_lists([{name:"Press",note:"Keyboard shortcut",type:"string",find:"",sift:1},{name:"Action",note:"What the shortcut does",type:"string",find:"",sift:1},{name:"Tag",note:"What aspect of the tool the item relates to",type:"string",find:"",sift:1,seed:"Default_Value_Demo"}]),list:[["alt+up","Add row above current selected cell","Row"],["alt+down","Add row below current selected cell","Row"],["alt+left","Add column to left of current selected cell","Column"],["alt+right","Add column to right of current selected cell","Right"],["f","Filter current cell column (`/regex/i`)","Column"],["/","Open menu and search for option","Tool"],["Enter","Edit","Cell"],["Enter","Insert\nNewline","Editor"],["CMD+Enter","Apply Edit","Cell"],["Arrow up","Select cell above","Cell"],["Arrow down","Select cell below","Cell"],["Arrow left","Select cell on the left","Cell"],["Arrow right","Select cell on the right","Cell"],["Hover","Show any tip","Tool"]]}),load_db_to_frontend()}function get_blank_column(){return{name:"",note:"",type:"any",sift:!1,find:""}}function fix_or_set_db_meta(e){return e?(void 0===e.name&&(e.name="Untitled DB"),void 0===e.made&&(e.made=get_stamp()),void 0===e.note&&(e.note=""),e):{name:"Untitled DB",note:"",made:get_stamp()}}function fix_or_set_column_data(e){return e.name??="",e.note??="",e.seed??="",e.type=column_type_fix(e.type),void 0===e.sift&&(e.sift=1),1==e.sift&&(e.sift=1),0==e.sift&&(e.sift=0),e.find??="",e}function revive_db(e){e.form&&is_object(e.form)&&(e.form=ob_of_lists__to__list_of_obs(e.form));let t=e.list?.[0]?.length;if(0===t&&e.form&&(t=e.form.length||0),t<1){let e="Input doesn't have expected data.\ne.g. {\"form\":{name:[c1v,c2v],…},\"list\":[['a1','b1,],…]}";return notify(e),void console.error(e)}if(null==e.form&&(e.form=[]),0==e.form.length||e.form.length<t)for(;e.form.length<t;)e.form.push(get_blank_column());return null!=e.list&&0!==e.list.length||(e.list=[create_empty_array(t)]),e.form=e.form.map(fix_or_set_column_data),g0.db=make_table({meta:fix_or_set_db_meta(e.meta),columns:e.form,records:e.list}),g0.db}function get_first_set_item(e){if(!e||0===e.size)return null;for(const t of e)return t}function right_click(e,t){on("contextmenu",(function(t){t.preventDefault(),on("mouseup",(function t(n){n.preventDefault(),e(n),off("mouseup",t,document)}),document)}),t)}function show_menu_for_row(e){const t=e.target.closest("tr");t&&(g0.row_to_act_on=t,show_row_actions(e))}function record_row_click_fn(e){const t=e.target.closest("tr");if(!t)return;t.record;e.target===t.firstChild?show_menu_for_row(e):g0.trs_selected.has(t)&&1===g0.trs_selected.size&&1===g0.selected_cells.size&&e.target===get_first_set_item(g0.selected_cells)?(align_prompt_po_to_click_xy(e),edit_record_cell()):(records_deselect_all(),deselect_all_cells(),"TD"==e.target.tagName&&select_cell(e.target))}function align_prompt_po_to_click_xy(e){position_element_where_user_clicked({event:e,element:el.prompt_po.querySelector(".faux_po_content")})}function deselect_all_cells(){records_deselect_all(),g0.selected_cells.size>0&&g0.selected_cells.forEach((e=>{e.classList.remove("selected")})),g0.selected_cells.clear()}on("click",copy_db_as_json,el.copy_db_as_json),on("click",(()=>{toggle_checkbox(el.show_compact)}),el.toggle_compact_mode),on("click",(()=>{toggle_checkbox(el.show_grid)}),el.toggle_ruled_grid),on("click",make_new_db,el.new_db),right_click(show_menu_for_row,el.db_tbody),on("click",record_row_click_fn,el.db_tbody);let popover_backdrops=document.querySelectorAll(".faux_po_backdrop");function select_cell(e){g0.selected_cells.add(e),e.classList.add("selected");let t=e.parentNode;t.classList.add("selected"),g0.trs_selected.add(t);let n=el.column_names.querySelectorAll("td"),o=-1,l="active_col";for(let t of e.parentNode.querySelectorAll("td"))o++,t==e?n[o].classList.add(l):n[o].classList.remove(l)}function make_and_return_tr_for_record__dont_add_to_dom(e){let t=new_el("tr");t.className="record";new_el("th",t);return e.forEach((e=>{new_el("td",t).textContent=e})),t.record=e,t}function figure_out_selected_row(){let e=g0.row_to_act_on;return e||(e=get_first_set_item(g0.selected_cells)?.parentNode),e}function add_tr_to_front_end(e,t=!1){let n=figure_out_selected_row();return n?(el.db_tbody.insertBefore(e,n),!1===t&&el.db_tbody.insertBefore(n,e)):el.db_tbody.insertBefore(e,el.db_tbody.firstChild),e}function make_new_record_data_from_search_queries(){let e=[];return el.filter_row.querySelectorAll("td").forEach((t=>{let n=t.column.seed;if(1===t.column.sift){let e=t.column.find.trim();if(e.length>0){e.length>2&&'"'==n[0]&&e.endsWith('"')||(n=e)}}e.push(n)})),e}function record_make_return_tr_if_displayed({above:e}){let t=figure_out_selected_row(),n=make_new_record_data_from_search_queries();t?n=(e?g0.db.record.insert_a_before_b:g0.db.record.insert_a_after_b)(n,t.record):(console.log("addToEnd"),n=g0.db.record.add(n)),mark_need_to_save(),filter_rows();let o=null;for(let e of el.db_tbody.querySelectorAll("tr"))if(e.record===n){o=e;break}return o?records_deselect_all():notify("Record added. May appear on another page or mismatch current filters"),o}function record_copy_as_js_ob(){let e=g0.row_to_act_on;e||console.log("record_copy_as_js_ob no row to act on");let t=e.record,n=[];el.column_names.querySelectorAll("td").forEach(((e,o)=>{let l=t[o];"string"==typeof l&&(l=`"${l}"`),n.push(`"${e.column.name}":${l}`)})),copy({str:`{\n${n.join(",\n")}\n}`,pass_fn:()=>notify("Copied row as JSON"),fail_fn:()=>notify("Failed to row as JSON")})}function record_clone(){let e=g0.row_to_act_on;if(!e)return void notify("Select a record to clone then try again");let t=e.record;add_tr_to_front_end(make_and_return_tr_for_record__dont_add_to_dom(g0.db.record.insert_a_after_b(JSON.parse(JSON.stringify(t)),t))),records_deselect_all(),mark_need_to_save()}popover_backdrops.forEach((e=>{right_click((e=>{e.target.click()}),e)}));let column_action={};function get_active_column_object(){return el.column_names.querySelectorAll("td")[g0.column_active_index].column}function determine_active_column_index(e){let t=e.closest("tr").querySelectorAll("td"),n=-1;for(let o=0;o<t.length;o++)if(t[o]===e){n=o;break}return n}function column_action_menu_click_handler(e){if(hide(el.column_actions_po),"BUTTON"!==e.target.tagName)return;let t=column_action,n={column_add_before:()=>t.add("before"),column_add_after:()=>t.add("after"),column_move_left:()=>t.move({left:!0}),column_move_right:()=>t.move({left:!1}),column_delete:t.delete,column_sort_a_z:()=>t.sort({reverse:!1}),column_sort_z_a:()=>t.sort({reverse:!0}),column_rename:t.rename,column_tweak_note:t.tweak_note,column_tweak_type:t.tweak_type}[e.target.id];n&&(n(),adjust_dimensions(),apply_relevant_style_to_columns_based_on_type())}function position_element_where_user_clicked({event:e,element:t}){const{clientX:n,clientY:o}=e;let{offsetWidth:l,offsetHeight:r}=t;const _=window.innerWidth,c=window.innerHeight;let i=n+l+3>_,a=o+r+3>c,s=i?Math.max(n-l-3,0):n+3,d=a?Math.max(c-r-3,0):o+3,u=shift_to_multiple(s,ch_as_px,i),m=shift_to_multiple(d,lh_as_px,a);t.style.left=u+"px",t.style.top=m+"px"}function shift_to_multiple(e,t,n){return Math[n?"floor":"ceil"](e/t)*t}function show_column_actions(e){g0.column_active_index=determine_active_column_index(e.target);e.target;let t=el.column_actions_po;show(t),position_element_where_user_clicked({event:e,element:t.querySelector(".faux_po_content")})}function row_action_menu_click_handler(e){if(hide(el.row_actions_po),"BUTTON"!==e.target.tagName)return;let t={record_make_above:()=>record_make_return_tr_if_displayed({above:!0}),record_make_below:()=>record_make_return_tr_if_displayed({above:!1}),record_delete_all_ticked:record_delete_all_ticked,record_delete_clicked:record_delete_clicked,record_clone:record_clone,record_copy_as_js_ob:record_copy_as_js_ob}[e.target.id];t&&(t(),record_facts_update_dom())}function show_row_actions(e){g0.trs_selected.size>1&&g0.trs_selected.has(g0.row_to_act_on)?(show(el.record_delete_all_ticked),hide(el.record_delete_clicked)):(hide(el.record_delete_all_ticked),show(el.record_delete_clicked)),show(el.row_actions_po),position_element_where_user_clicked({event:e,element:el.row_actions_po.querySelector(".faux_po_content")})}function apply_relevant_style_to_columns_based_on_type(){let e=[];el.column_names.querySelectorAll("td").forEach(((t,n)=>{const o=n+1;"number"===t.column.type&&e.push(`\n        #db_table td:nth-of-type(${o}) {\n          text-align: right;\n        }\n      `)})),el.column_styles.innerHTML=e.join("\n")}column_action.move=({left:e,thenFn:t})=>{let n=e,o=!e;if(n&&0==g0.column_active_index)notify("Already left-most");else if(o&&g0.column_active_index===el.column_names.querySelectorAll("td").length-1)notify("already right-most");else{let r=g0.column_active_index;if(n)g0.db.column.move_left(r);else{if(!o)return;g0.db.column.move_right(r)}function l(e){let t=e.querySelectorAll("td")[r+o];e.insertBefore(t,t.previousElementSibling)}console.log({before_move_idx:r,cols:g0.db.column.get_all()}),el.db_thead.querySelectorAll("tr").forEach(l),el.db_tbody.querySelectorAll("tr").forEach(l),mark_need_to_save()}t&&t()},column_action.tweak_type=()=>{let e=get_active_column_object(),t=e.name.trim();el.column_type_current_column_name.textContent=t.length<1?'"Untitled Column"':`"${t}"`,el.column_type_picker.value=e.type,show(el.column_type_po)},on("input",(()=>{get_active_column_object().type=el.column_type_picker.value,mark_need_to_save(),apply_relevant_style_to_columns_based_on_type()}),el.column_type_picker),on("click",(e=>{hide(el.column_type_po)}),el.column_type_po_hide),on("click",(e=>{hide(el.prompt_po)}),el.prompt_po_hide),column_action.tweak_note=()=>{let e=el.column_names.querySelectorAll("td")[g0.column_active_index],t=e.column;ui.prompt({message:`Tweak Note for "${t.name}"`,initial:t.note,yes_fn:n=>{null===n&&console.log("No value returned"),e.dataset.tip=n,t.note=n,mark_need_to_save()},no_fn:()=>{notify('Stopped "Edit Column Note"')}})},column_action.rename=()=>{let e=el.column_names.querySelectorAll("td")[g0.column_active_index],t=e.textContent;ui.prompt({message:`Rename Column "${t}"`,initial:t,yes_fn:t=>{e.column.name=t,e.textContent=t,mark_need_to_save()},no_fn:()=>{notify('User cancelled "Rename Column"')}})},column_action.sort=({reverse:e=!1})=>{let t=g0.column_active_index;ui.confirm({text:`Sort "${g0.db.column.get_by_index(t).name}" Column (${e?"Z-A":"A-Z"})\n(No 'undo' available afterwards)`,yes_fn:()=>{g0.db.sort_records({column_index:t,reverse:e}),filter_rows(),mark_need_to_save()},no_fn:()=>{notify("Cancelled 'Sort Column'")}})},column_action.delete=()=>{if(el.column_names.querySelectorAll("td").length<2)return void notify("Table needs at least 1 Data Column");let e=g0.column_active_index;ui.confirm({text:"Delete column and all data in it (permanent)",yes_fn:()=>{function t(t){t.querySelectorAll("td")[e].remove()}g0.db.column.delete(e),el.db_thead.querySelectorAll("tr").forEach(t),el.db_tbody.querySelectorAll("tr").forEach(t),notify('"Deleted Column"'),filter_rows(),mark_need_to_save()},no_fn:()=>notify('Cancelled "Delete Column"')})},column_action.add=e=>{let t="after"===e,n="before"===e,o=null,l=(t?g0.db.column.insert_after:g0.db.column.insert_before)({index:g0.column_active_index,object:get_blank_column()}),r=null;function _(e){return _=>{var c;r=e?_.make_new_cell(l):new_el("td"),o=_.querySelectorAll("td")[g0.column_active_index],n?_.insertBefore(r,o):t&&(c=r,o.insertAdjacentElement("afterend",c))}}el.db_thead.querySelectorAll("tr").forEach(_(!0)),el.db_tbody.querySelectorAll("tr").forEach(_(!1)),mark_need_to_save()},on("click",column_action_menu_click_handler,el.column_actions_po),right_click((e=>{e.preventDefault(),"TD"===e.target.tagName&&show_column_actions(e)}),el.db_thead),on("click",row_action_menu_click_handler,el.row_actions_po);const make_row={};function process_filter_inputs(){let e=g0.current_filter_cell;e.column.find=el.filter_query.value.trim(),update_filter_display_name(e),mark_need_to_save(),filter_rows()}function hide_filter_popover(){g0.current_filter_cell.classList.remove("selected"),g0.current_filter_cell=null,hide(el.filter_popover),select_cell_a1_if_any()}function update_filter_display_name(e){let t,n=e.column;t=n.sift&&n.find.length>0?n.find:"",t?e.dataset.tip=t:delete e.dataset.tip}function show_filter_popover(e){let t=e.target;g0.current_filter_cell=t,g0.current_filter_cell.classList.add("selected"),show(el.filter_popover),position_element_where_user_clicked({event:e,element:el.filter_popover.querySelector(".faux_po_content")}),el.filter_query.focus(),el.filter_switch.textContent=t.column.sift?"Doze":"Wake",el.filter_query.value=t.column.find}function activate_active_column_filter_editor(){if(1!==g0.selected_cells?.size)return void notify('If you select a cell, "F" key opens the column filter');let e=get_first_set_item(g0.selected_cells),t=[...e.parentNode.querySelectorAll("td")].indexOf(e);el.filter_row.querySelectorAll("td")[t].click()}function setup_db_name(e){el.db_name.meta=e,el.db_name.textContent=el.db_name.meta.name,el.db_name.onclick=()=>{ui.prompt({message:"Rename DB",initial:el.db_name.meta.name,yes_fn:e=>{e=e.trim(),el.db_name.textContent=e,el.db_name.meta.name=e},no_fn:()=>{notify("Cancelled rename DB")}})}}make_row.name=e=>{let t=new_el("tr",el.db_thead);el.column_names=t;new_el("th",t);t.make_new_cell=e=>{let n=new_el("td",t);return n.dataset.tip=e.note,n.column=e,n.textContent=e.name,n.onclick=show_column_actions,n},e.column.get_all().forEach(t.make_new_cell)},on("input",process_filter_inputs,el.filter_query),on("click",(()=>{let e=g0.current_filter_cell,t=!e.column.sift;e.column.sift=t?1:0,el.filter_switch.textContent=t?"Doze":"Wake",process_filter_inputs()}),el.filter_switch),on("click",(()=>{hide_filter_popover()}),el.filter_popover_hide),make_row.find=e=>{let t=new_el("tr",el.db_thead);t.id="filter_row",el.filter_row=t;let n=new_el("th",t);n.textContent="Find",n.dataset.tip="Show rows whose columns contain these values",t.make_new_cell=e=>{let n=new_el("td",t);return n.column=e,update_filter_display_name(n),n.onclick=show_filter_popover,n},e.column.get_all().forEach(t.make_new_cell)};let page={};function make_or_remake_DOM_record_rows(e){g0.records_matching_current_filters=e;const t=Number(el.page$rows_each.value);g0.page.total=Math.max(1,Math.ceil(e.length/t)),g0.page.current>g0.page.total&&(g0.page.current=g0.page.total),el.page_number.textContent=g0.page.current,el.page_total.textContent=g0.page.total;const n=(g0.page.current-1)*t,o=n+t,l=e.slice(n,o);page.update_button_states(),batch_add_record_trs_to_dom(l.map(make_and_return_tr_for_record__dont_add_to_dom)),select_cell_a1_if_any(),record_facts_update_dom(),adjust_dimensions()}function batch_add_record_trs_to_dom(e){const t=document.createDocumentFragment();e.forEach((e=>t.appendChild(e))),el.db_tbody.innerHTML="",el.db_tbody.appendChild(t)}function make_DOM_header_rows(){el.db_thead.innerHTML="",setup_db_name(g0.db.meta),make_row.name(g0.db),apply_relevant_style_to_columns_based_on_type(),make_row.find(g0.db)}function load_db_to_frontend(){make_DOM_header_rows(),filter_rows()}function clear_menu_items_searcher(){0==el.menu_items_searcher.value.trim().length?(el.menu_items_searcher.blur(),el.main_menu_po.hidePopover()):(el.menu_items_searcher.value="",el.menu_items_searcher.focus(),search_menu_items())}function show_license_popover(){el.po_license.showPopover()}function show_main_menu_popover(){el.main_menu_po.showPopover(),el.menu_items_searcher.focus()}page.update_button_states=()=>{let e=g0.page.current<2;el.page_left.disabled=e;let t=g0.page.current===g0.page.total;el.page_right.disabled=t},page.show_previous=()=>{g0.page.current<2||(g0.page.current--,make_or_remake_DOM_record_rows(g0.records_matching_current_filters))},on("click",page.show_previous,el.page_left),page.show_next=()=>{g0.current_page===g0.page.total||(g0.page.current++,make_or_remake_DOM_record_rows(g0.records_matching_current_filters))},on("click",page.show_next,el.page_right),on("input",(()=>{make_or_remake_DOM_record_rows(g0.records_matching_current_filters)}),el.page$rows_each),on("input",search_menu_items,el.menu_items_searcher),on("click",(e=>{el.main_menu_po.hidePopover()}),el.menu_items),on("click",show_license_popover,el.show_po_license),on("click",show_main_menu_popover,el.show_main_menu_po),on("focus",(()=>{search_menu_items()}),el.menu_items_searcher);let menu_items=[...el.menu_items.getElementsByTagName("DIV")].map((e=>{let t={dom:e,dom_text:e.textContent.toLowerCase().trim()};return t.words=t.dom_text.split(/\s+/),t}));function search_menu_items(){let e=el.menu_items_searcher.value.toLowerCase().trim();function t(e){g0.menu_items_matching_search.push(e),show(e.dom)}if(g0.menu_items_matching_search.length=0,g0.selected_menu_item=null,0==e.length)menu_items.forEach((e=>{!e.dom.classList.contains("disabled")?t(e):hide(e.dom)}));else{let n=e.split(/\s+/);n.length;menu_items.forEach((e=>{let o=!e.dom.classList.contains("disabled"),l=(r=e.words,n.every((e=>r.some((t=>t.startsWith(e))))));var r;o&&l?t(e):hide(e.dom)}))}select_menu_item_below()}function select_menu_item(e){e.dom.querySelector("input").checked=!0,g0.selected_menu_item=e}function select_menu_item_below(){let e=g0.menu_items_matching_search.length>0?g0.menu_items_matching_search:menu_items;if(0===e.length)return;let t=e.indexOf(g0.selected_menu_item),n=e.length-1==t?0:t+1;t!==n&&(select_menu_item(e[n]),scroll_into_view_if_needed(g0.selected_menu_item.dom))}function select_menu_item_above(){let e=g0.menu_items_matching_search.length>0?g0.menu_items_matching_search:menu_items;if(0===e.length)return;let t=e.indexOf(g0.selected_menu_item),n=t<1?e.length-1:t-1;t!==n&&(select_menu_item(e[n]),scroll_into_view_if_needed(g0.selected_menu_item.dom),scroll_into_view_if_needed(g0.selected_menu_item.dom))}function menu_items_searcher__enter(e){e.preventDefault(),g0.selected_menu_item&&(e.target.blur(),e.target.value="",g0.selected_menu_item.dom.click())}function edit_record_cell(){if(1!==g0.selected_cells?.size)return void notify('If you select a cell, "Enter" key will start edit mode');let e=get_first_set_item(g0.selected_cells),t=e.parentNode,n=[...t.querySelectorAll("td")].indexOf(e),o=t.record;ui.prompt({initial:o[n]??"",yes_fn:t=>{let l=el.column_names.querySelectorAll("td")[n].column;t=t.trim(),e.textContent=t,o[n]=convert_to_correct_data_type(l.type,t),filter_rows(),mark_need_to_save()},no_fn:()=>{notify("Cancelled editing cell")}})}function record_delete_one(e){g0.db.record.delete(e.record),e.remove(),g0.trs_selected.delete(e)}function record_delete_clicked(){record_delete_one(g0.row_to_act_on)}function record_delete_all_ticked(){let e=g0.trs_selected.size;ui.confirm({text:`Delete ${e} ticked rows?`,yes_fn:()=>{g0.trs_selected.forEach(record_delete_one),filter_rows(),mark_need_to_save(),notify(`Deleted ${e} rows`)},no_fn:()=>notify('Cancelled "delete ticked rows"')})}function record_facts_update_dom(){el.record_facts$filter_matches.textContent=g0.records_matching_current_filters.length,el.record_facts$total.textContent=g0.db.record.length}function scroll_into_view_if_needed(e){const t=e.getBoundingClientRect(),n=e.parentNode,o=n.getBoundingClientRect();let l=t.top<o.top;t.bottom>o.bottom?n.scrollTop+=t.bottom-o.bottom:l&&(n.scrollTop+=t.top-o.top)}function records_deselect_all(){g0.trs_selected.forEach(deselect_row),g0.trs_selected.clear()}function deselect_row(e){if(!e)return console.log("pass deselect_row a TR");e.classList.remove("selected"),g0.trs_selected.delete(e)}function get_first_set_item(e){return e.values().next().value}function get_adjacent_td(e,t){if(!(e instanceof HTMLTableCellElement))return console.error("Invalid TD element."),!1;const n=e.parentElement;if(!n||"tr"!==n.nodeName.toLowerCase())return!1;const o=Array.from(n.querySelectorAll("td")),l=o.indexOf(e);if("left"===t)return l>0&&o[l-1];if("right"===t)return l<o.length-1&&o[l+1];const r=n.parentElement;if(!r||"tbody"!==r.nodeName.toLowerCase())return!1;const _=Array.from(r.querySelectorAll("tr:not(.hide)")),c=_.indexOf(n),i=e=>{const t=Array.from(e.querySelectorAll("td"));return t.length>l&&t[l]};return"above"===t?c>0&&i(_[c-1]):"below"===t?c<_.length-1&&i(_[c+1]):(console.error("Invalid direction. Use 'left', 'right', 'above', or 'below'."),!1)}let get_only_selected_cell_else_false=()=>!(1!==g0.selected_cells.size)&&get_first_set_item(g0.selected_cells),select_cell_adjacent=e=>{let t=get_only_selected_cell_else_false();if(!t)return void select_cell_a1_if_any();let n=get_adjacent_td(t,e);if(!n)return!1;deselect_all_cells(),select_cell(n)};function get_first_visible_td(e){if(!e||"tbody"!==e.nodeName.toLowerCase())return console.error("Provided element is not a valid tbody."),!1;const t=e.querySelector("tr:not(.hide)");if(!t)return!1;return t.querySelector("td")||!1}function select_cell_a1_if_any(){let e=get_first_visible_td(el.db_tbody);e&&(deselect_all_cells(),select_cell(e))}function find_first_index(e,t){for(let n=0;n<e.length;n++)if(t(e[n]))return n;return-1}function find_last_index(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}function make_row_or_col_adjacent({left:e,right:t,above:n,below:o}){let l=get_only_selected_cell_else_false();if(!l)return;let r=determine_active_column_index(l);if(e||t)g0.column_active_index=r,column_action.add(e?"before":"after"),select_cell_adjacent(e?"left":"right");else if(n||o){g0.row_to_act_on=l.parentNode;let e=record_make_return_tr_if_displayed({above:n});e&&(deselect_all_cells(),select_cell(e.querySelectorAll("td")[r]))}}function window_key_listener(e){let t;if(document.activeElement==el.menu_items_searcher)t={Escape:clear_menu_items_searcher,Enter:menu_items_searcher__enter,ArrowDown:select_menu_item_below,ArrowUp:select_menu_item_above}[e.key];else if(document.activeElement===el.prompt_input){t={cmd_Enter:()=>el.prompt_button_yes.click(),Escape:_prompt_input_escape_key}[(e.metaKey?"cmd_":"")+e.key]}else if(null!==g0.current_filter_cell&&void 0!==g0.current_filter_cell)t={Escape:hide_filter_popover,Enter:hide_filter_popover}[e.key];else{if(null!==document.querySelector("dialog[open]")||null!==document.querySelector(":popover-open"))return;t={"/":show_main_menu_popover,f:activate_active_column_filter_editor,Enter:edit_record_cell,alt_ArrowUp:()=>make_row_or_col_adjacent({above:1}),alt_ArrowDown:()=>make_row_or_col_adjacent({below:1}),alt_ArrowLeft:()=>{make_row_or_col_adjacent({left:1}),adjust_dimensions()},alt_ArrowRight:()=>{make_row_or_col_adjacent({right:1}),adjust_dimensions()},ArrowUp:()=>select_cell_adjacent("above"),ArrowDown:()=>select_cell_adjacent("below"),ArrowLeft:()=>select_cell_adjacent("left"),ArrowRight:()=>select_cell_adjacent("right")}[(e.altKey?"alt_":"")+e.key]}t&&(e.preventDefault(),t(e))}function _prompt_input_escape_key(e){e.preventDefault();let t=e.target;if(0===t.value.length)return _prompt_no();t.value="",t.focus()}on("keydown",window_key_listener,window),on("click",(()=>{let e=get_stamp(),t=el.prompt_input,n=t.value.trim();0!=n.length?t.value=n+" "+e:t.value=e}),el.insert_date);const ui={};function _prompt_no(){g0.prompt_pending=!1,hide(el.prompt_po),g0.prompt_no_fn&&(g0.prompt_no_fn(),g0.prompt_no_fn=null),el.prompt_input.value=""}function _prompt_yes(){g0.prompt_pending=!1,hide(el.prompt_po),g0.prompt_yes_fn&&(g0.prompt_yes_fn(el.prompt_input.value),g0.prompt_yes_fn=null),el.prompt_input.value=""}ui.prompt=({message:e,initial:t,yes_fn:n=null,no_fn:o=null,y_text:l="Apply",n_text:r="Exit"})=>{g0.prompt_pending=!0,e?(el.prompt_message.textContent=e,show(el.prompt_message)):hide(el.prompt_message),g0.prompt_yes_fn=n,g0.prompt_no_fn=o,el.prompt_input.value=t,show(el.prompt_po),el.prompt_input.focus(),el.prompt_button_no.textContent=r,el.prompt_button_yes.textContent=l},on("click",_prompt_no,el.prompt_button_no),on("click",_prompt_yes,el.prompt_button_yes),on("click",(()=>{g0.prompt_pending&&_prompt_no()}),el.prompt_po_hide),ui.confirm=({text:e="",yes:t="Yes",no:n="No",yes_fn:o,no_fn:l})=>{o||console.warn("Pass confirm a yes_fn"),g0.confirm_yes_fn=o,g0.confirm_no_fn=l,el.confirm_message.textContent=e,el.confirm_button_yes.textContent=t,el.confirm_button_no.textContent=n,el.confirm_dialog.showModal(),el.confirm_button_yes.focus()},on("click",(()=>{el.confirm_dialog.close(),g0.confirm_yes_fn&&(g0.confirm_yes_fn(),g0.confirm_yes_fn=null)}),el.confirm_button_yes),on("click",(()=>{el.confirm_dialog.close(),g0.confirm_no_fn&&(g0.confirm_no_fn(),g0.confirm_no_fn=null)}),el.confirm_button_no);let notify_timer=null;function notify(e){el.notice.textContent=e,show(el.notice),notify_timer=setTimeout((()=>hide(el.notice)),3e3)}on("click",(()=>{el.table_holder.scrollTop=0}),el.scroll_to_top);
/* fs.js */
async function ungzip_to_text(e){let t=e;e instanceof ArrayBuffer&&(t=new Blob([e]));const a=t.stream().pipeThrough(new DecompressionStream("gzip")),n=await new Response(a).blob(),i=await function(e){return new Promise(((t,a)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=a,n.readAsText(e)}))}(n);return i}function mark_need_to_save(){g0.has_unsaved_changes=!0,el.current_saved_status.textContent="Unsaved",g0.allow_auto_save=!0}function mark_as_saved(){g0.has_unsaved_changes=!1,el.current_saved_status.textContent="Saved"}function took(e){return"Took "+function(e){const t=Math.floor(e/1e3),a=Math.floor(t/60),n=t%60;return 0===a?n+"s":`${a}m ${n}s`}(performance.now()-e)}function restore(e){if(!e)return console.log("No data stored to restore");revive_db(JSON.parse(e)),load_db_to_frontend()}function supports_file_system_access_api(){return"showOpenFilePicker"in window&&"showSaveFilePicker"in window}const idb=(()=>{const e="files";let t=null;const a={open_db:()=>new Promise(((a,n)=>{const i=indexedDB.open("2025_0506_db",1);i.onupgradeneeded=t=>{const a=t.target.result;a.objectStoreNames.contains(e)||a.createObjectStore(e,{keyPath:"id"})},i.onsuccess=e=>{t=e.target.result,a()},i.onerror=e=>n(e.target.error)}))},n=(a,n)=>new Promise(((i,o)=>{const s=n(t.transaction(e,a).objectStore(e));s.onsuccess=()=>i(s.result),s.onerror=e=>o(e.target.error)}));return a.save_handle=(e,t,a,i=null)=>{const o=i||Date.now();return n("readwrite",(n=>n.put({id:o,handle:e,baseName:t,ext:a,lastOpened:Date.now()})))},a.get_all_handles=()=>n("readonly",(e=>e.getAll())),a.get_handle=e=>n("readonly",(t=>t.get(e))),a.delete_handle=e=>n("readwrite",(t=>t.delete(e))),a.update_last_opened=n=>new Promise((async(i,o)=>{const s=await a.get_handle(n);if(!s)return o(Error("File record not found"));s.lastOpened=Date.now();const l=t.transaction(e,"readwrite").objectStore(e).put(s);l.onsuccess=()=>i(),l.onerror=e=>o(e.target.error)})),a.update_filename=async(e,t,i)=>{const o=await a.get_handle(e);if(!o)throw Error("File record not found");return o.baseName=t,o.ext=i,n("readwrite",(e=>e.put(o)))},a})(),fs={check_permission:async(e,t="readwrite")=>{const a={mode:t};return"granted"===await e.queryPermission(a)||"granted"===await e.requestPermission(a)}},set_file_status=e=>{el.file_status.textContent=e},show_file_dialog=e=>{el.file_dialog_message.textContent=e,el.file_dialog.showModal()};function get_extension(e){const t=e.split(".");return 1===t.length?"":2===t.length?"."+t[1]:"."+t.slice(-2).join(".")}function get_basename(e){const t=get_extension(e);return t?e.slice(0,-t.length):e}async function populate_recent_files_table(){const e=await idb.get_all_handles();e.sort(((e,t)=>t.lastOpened-e.lastOpened)),el.recent_files.innerHTML="<tr><td>No Recent Files</td><td></td><td></td><td></td></tr>",e.forEach(((e,t)=>{const a=document.createElement("tr");a.dataset.fileId=e.id,g0.open_file_id===e.id&&a.classList.add("currently_open_file");const n=document.createElement("td");n.textContent=e.baseName,a.appendChild(n);const i=document.createElement("td");i.textContent=e.ext,a.appendChild(i);const o=document.createElement("td"),s=document.createElement("button");s.textContent="Open",s.onclick=()=>open_file_by_id(e.id),o.appendChild(s),a.appendChild(o);const l=document.createElement("td"),_=document.createElement("button");_.textContent="Forget",_.onclick=()=>f_action.file_forget(e.id),l.appendChild(_),a.appendChild(l),el.recent_files.appendChild(a),0===t&&s.focus()}))}async function open_file_by_id(e){const t=await idb.get_handle(e);if(!t)return set_file_status("File record not found");await f_action.load_editor(t.handle,t.baseName+t.ext,e),hide_recent_files_list()}on("click",(()=>{el.file_dialog.close()}),el.file_dialog_done_button),window.addEventListener("beforeunload",(e=>{g0.has_unsaved_changes&&e.preventDefault()}));const f_action={};async function open_and_process_a_selected_or_dropped_file(e){const t=(await e.getFile()).name,a=get_extension(t),n=get_basename(t);set_file_status("Checking file...");const i=await idb.get_all_handles();let o=null;for(const t of i)if(await e.isSameEntry(t.handle)){o=t;break}if(o)await f_action.load_editor(e,t,o.id);else{const i=Date.now();await idb.save_handle(e,n,a,i),await f_action.load_editor(e,t,i)}hide_recent_files_list()}f_action.update_file_buttons=async()=>{(await idb.get_all_handles()).length;[el.file_save,el.file_close].forEach(g0.file_is_loaded?enable:disable),enable(el.file_save_as),enable(el.file_select)},f_action.load_editor=async(e,t,a)=>{if(await f_action.file_close(),reset_app(),set_file_status("Reading file..."),!await fs.check_permission(e,"readwrite"))throw Error("ReadWrite Permission denied");const n=await e.getFile();if(n.name!==t){const e=get_extension(n.name),i=get_basename(n.name);await idb.update_filename(a,i,e),t=n.name}let i,o=n.type.startsWith("application/json"),s=n.type.startsWith("application/gzip")||n.type.startsWith("application/x-gzip");if(!(o||s))return show_file_dialog("Not JSON / Gzipped JSON file");if(o&&(i=await n.text()),s){const e=await n.arrayBuffer();i=await ungzip_to_text(e)}restore(i),mark_as_saved(),g0.file_is_loaded=!0,g0.open_file_handle=e,g0.open_file_id=a,await idb.update_last_opened(a),set_file_status(`Loaded "${t}"`),await populate_recent_files_table(),await f_action.update_file_buttons()},f_action.save_content=async(e,t)=>{const a=performance.now();if(!await fs.check_permission(e))throw Error("Write permission denied");const n=await e.createWritable();let i=live_db_to_JSON("");if(t.endsWith(".gz")){const e=new TextEncoder,t=new ReadableStream({start(t){t.enqueue(e.encode(i)),t.close()}}).pipeThrough(new CompressionStream("gzip"));await t.pipeTo(n)}else await n.write(i),await n.close();set_file_status("File saved successfully. "+took(a)),g0.file_is_loaded=!0,mark_as_saved()},f_action.file_save=async()=>{if(!g0.open_file_handle)return f_action.file_save_as();const e=await idb.get_handle(g0.open_file_id);if(!e)return f_action.file_save_as();await fs.check_permission(g0.open_file_handle)||set_file_status("Permission denied."),await f_action.save_content(g0.open_file_handle,e.baseName+e.ext),await f_action.update_file_buttons()},f_action.file_save_as=async()=>{const e=await window.showSaveFilePicker({suggestedName:get_stamp()+".gz",types:[{description:"JSON",accept:{"application/json":[".json"]}},{description:"Gzip Compressed File",accept:{"application/gzip":[".gz"],"application/x-gzip":[".gz"]}}]});if(!await fs.check_permission(e))return set_file_status("Permission denied.");const t=await e.getFile(),a=get_extension(t.name),n=get_basename(t.name),i=await idb.get_all_handles();let o=null;for(const t of i)if(await e.isSameEntry(t.handle)){o=t.id;break}if(o)await idb.save_handle(e,n,a,o),g0.open_file_id=o;else{const t=Date.now();await idb.save_handle(e,n,a,t),g0.open_file_id=t}g0.open_file_handle=e,await f_action.save_content(e,t.name),await populate_recent_files_table(),await f_action.update_file_buttons()},f_action.file_select=async()=>{try{const[e]=await window.showOpenFilePicker();await open_and_process_a_selected_or_dropped_file(e)}catch(e){"AbortError"===e.name?notify("Cancelled 'open file'"):console.error("An error occurred:",e)}},f_action.file_close=async()=>!(g0.has_unsaved_changes&&!confirm("You have unsaved changes. Close anyway?"))&&(reset_app(),load_example_db(),set_file_status("File closed."),g0.open_file_handle=null,g0.open_file_id=null,await populate_recent_files_table(),await f_action.update_file_buttons(),!0),f_action.file_forget=async e=>{if(confirm("Forget this file? (You can re-open it later)")){if(g0.open_file_id===e){if(!await f_action.file_close())return}await idb.delete_handle(e),set_file_status("File forgotten."),await populate_recent_files_table(),await f_action.update_file_buttons()}};const initiate_indexedDB_and_file_access_api=async()=>{await idb.open_db();const e=await idb.get_all_handles();e.length>0?set_file_status(`Found ${e.length} remembered file${1===e.length?"":"s"}`):set_file_status("No stored file references. Open or Save As to begin."),await populate_recent_files_table(),e.length>0&&show_recent_files_list(),await f_action.update_file_buttons();["file_select","file_close","file_save","file_save_as"].forEach((e=>{el[e].onclick=f_action[e]}))};function setup_auto_save(){function e(){g0.allow_auto_save&&(g0.allow_auto_save=!1,g0.file_is_loaded&&g0.page_loaded&&g0.has_unsaved_changes&&(console.log("try save"),f_action.file_save()))}on("blur",e,window),on("beforeunload",e,window),on("pagehide",e,window),on("visibilitychange",e,document),g0.page_loaded=!0}function setup_drag_drop(){window.addEventListener("dragover",(e=>{e.preventDefault(),show(el.dragover_notice)})),window.addEventListener("dragleave",(e=>{0===e.clientX&&0===e.clientY&&hide(el.dragover_notice)})),window.addEventListener("dragend",(e=>{e.preventDefault(),hide(el.dragover_notice)})),window.addEventListener("drop",(async e=>{e.preventDefault(),hide(el.dragover_notice);try{const t=e.dataTransfer.items;if(!t||0===t.length)return;const a=t[0];if("file"!==a.kind)return;const n=await a.getAsFileSystemHandle();if(!n||"file"!==n.kind)return show_file_dialog("Please drop a file, not a folder");await open_and_process_a_selected_or_dropped_file(n)}catch(e){console.error("Drop error:",e),set_file_status("Error processing dropped file")}}))}async function initiate(){supports_file_system_access_api()?(await initiate_indexedDB_and_file_access_api(),await f_action.update_file_buttons(),g0.file_is_loaded||load_example_db(),setup_auto_save(),setup_drag_drop()):show(el.unsupported_browser)}function hide_recent_files_list(){el.po_recent_files_holder.hidePopover()}function show_recent_files_list(){el.po_recent_files_holder.showPopover();let e=el.po_recent_files_holder.querySelector("button");e&&e.focus()}on("click",show_recent_files_list,el.see_recent_files),on("load",initiate,window);
/* grid.js */
let ch_as_px=get_ch_width(),lh_as_px=15;function get_ch_width(t){const e=document.createElement("span");t&&(e.style.fontSize=t),e.style.position="fixed",e.style.visibility="hidden",e.style.whiteSpace="nowrap",e.textContent="0",document.body.appendChild(e);const o=e.offsetWidth;return document.body.removeChild(e),o}function scroll_snap_to_grid(t,e,o){let n;const d=()=>{const n=Math.round(t.scrollTop/e)*e,d=Math.round(t.scrollLeft/o)*o;t.scrollTo({top:n,left:d,behavior:"smooth"})};t.addEventListener("scroll",(()=>{clearTimeout(n),n=setTimeout((()=>{d()}),100)})),t.addEventListener("wheel",(e=>{e.preventDefault();const o=e.deltaY,s=e.deltaX;t.scrollTop+=o,t.scrollLeft+=s,clearTimeout(n),n=setTimeout((()=>{d()}),100)}))}function adjust_width(t){t.style.width="auto";const e=t.getBoundingClientRect().width,o=t.parentNode.clientWidth,n=ch_as_px;let d=Math.round(e/n)*n;d>o&&(d=Math.floor(o/n)*n),d!==e&&(t.style.width=d+"px")}function adjust_dimensions(){adjust_width(el.db_table)}scroll_snap_to_grid(el.table_holder,lh_as_px,ch_as_px),window.addEventListener("resize",adjust_dimensions),window.addEventListener("load",adjust_dimensions);</script></body></html>